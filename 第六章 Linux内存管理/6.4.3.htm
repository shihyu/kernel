<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">


<!-- Mirrored from www.kerneltravel.net/kernel-book/ç¬¬å…­ç« %20Linuxå†…å­˜ç®¡ç†/6.4.3.htm by HTTrack Website Copier/3.x [XR&CO'2008], Sat, 29 Dec 2012 03:00:46 GMT -->
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="6.4.3.files/filelist.html">
<title> ÄÚ´æÓ³Éä</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="chsdate" downloadurl=""/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="chmetcnv" downloadurl=""/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>CLJ</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>CLJ</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>1</o:TotalTime>
  <o:Created>2007-08-15T08:06:00Z</o:Created>
  <o:LastSaved>2007-08-15T08:06:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>1664</o:Words>
  <o:Characters>9490</o:Characters>
  <o:Lines>79</o:Lines>
  <o:Paragraphs>22</o:Paragraphs>
  <o:CharactersWithSpaces>11132</o:CharactersWithSpaces>
  <o:Version>11.5606</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:GrammarState>Clean</w:GrammarState>
  <w:PunctuationKerning/>
  <w:DrawingGridVerticalSpacing>7.8 °õ</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:AdjustLineHeightInTable/>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:ËÎÌå;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:SimSun;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
@font-face
	{font-family:"\@ËÎÌå";
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	mso-pagination:none;
	font-size:10.5pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:ËÎÌå;
	mso-font-kerning:1.0pt;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
 /* Page Definitions */
 @page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:42.55pt;
	mso-footer-margin:49.6pt;
	mso-paper-source:0;
	layout-grid:15.6pt;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:106584600;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l1
	{mso-list-id:126439355;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l2
	{mso-list-id:414782750;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l2:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l3
	{mso-list-id:816728170;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l3:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l4
	{mso-list-id:1522473522;
	mso-list-type:simple;
	mso-list-template-ids:1190566736;}
@list l4:level1
	{mso-level-text:£¨%1£©;
	mso-level-tab-stop:33.6pt;
	mso-level-number-position:left;
	margin-left:33.6pt;
	text-indent:-24.0pt;}
@list l5
	{mso-list-id:1991863065;
	mso-list-template-ids:1589661822;}
@list l5:level1
	{mso-level-text:"\(%1\)";
	mso-level-tab-stop:60.25pt;
	mso-level-number-position:left;
	margin-left:60.25pt;
	text-indent:-18.0pt;}
@list l5:level2
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:63.25pt;
	mso-level-number-position:left;
	margin-left:63.25pt;
	text-indent:-21.0pt;}
@list l5:level3
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:84.25pt;
	mso-level-number-position:right;
	margin-left:84.25pt;
	text-indent:-21.0pt;}
@list l5:level4
	{mso-level-tab-stop:105.25pt;
	mso-level-number-position:left;
	margin-left:105.25pt;
	text-indent:-21.0pt;}
@list l5:level5
	{mso-level-number-format:alpha-lower;
	mso-level-text:"%5\)";
	mso-level-tab-stop:126.25pt;
	mso-level-number-position:left;
	margin-left:126.25pt;
	text-indent:-21.0pt;}
@list l5:level6
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:147.25pt;
	mso-level-number-position:right;
	margin-left:147.25pt;
	text-indent:-21.0pt;}
@list l5:level7
	{mso-level-tab-stop:168.25pt;
	mso-level-number-position:left;
	margin-left:168.25pt;
	text-indent:-21.0pt;}
@list l5:level8
	{mso-level-number-format:alpha-lower;
	mso-level-text:"%8\)";
	mso-level-tab-stop:189.25pt;
	mso-level-number-position:left;
	margin-left:189.25pt;
	text-indent:-21.0pt;}
@list l5:level9
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:210.25pt;
	mso-level-number-position:right;
	margin-left:210.25pt;
	text-indent:-21.0pt;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:ÆÕÍ¨±í¸ñ;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=ZH-CN style='tab-interval:21.0pt;text-justify-trim:punctuation'>

<div class=Section1 style='layout-grid:15.6pt'>

<p class=MsoNormal align=left style='text-align:left;mso-outline-level:1;
mso-layout-grid-align:none;text-autospace:none'><st1:chsdate Year="1899"
Month="12" Day="30" IsLunarDate="False" IsROCDate="False" w:st="on"><b
 style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:ËÎÌå;
 mso-hansi-font-family:"Times New Roman";color:black;mso-font-kerning:0pt'>6.4.3</span></b></st1:chsdate><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:ËÎÌå;
mso-hansi-font-family:"Times New Roman";color:black;mso-font-kerning:0pt'> </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'>ÄÚ´æÓ³Éä<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";
color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></b><span
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>µ±Ä³¸ö³ÌĞòµÄ<span class=GramE>Ó³Ïó</span>¿ªÊ¼Ö´ĞĞÊ±£¬¿ÉÖ´ĞĞ<span
class=GramE>Ó³Ïó</span>±ØĞë×°Èë<span class=GramE>µ½½ø³Ì</span>µÄĞéÄâµØÖ·¿Õ¼ä¡£Èç¹û¸Ã½ø³ÌÓÃµ½ÁËÈÎºÎÒ»¸ö¹²Ïí¿â£¬Ôò¹²Ïí¿âÒ²±ØĞë×°Èë<span
class=GramE>µ½½ø³Ì</span>µÄĞéÄâµØÖ·¿Õ¼ä¡£ÓÉ´Ë¿É¿´³ö£¬<span lang=EN-US>Linux</span>²¢²»½«<span
class=GramE>Ó³Ïó</span>×°Èëµ½ÎïÀíÄÚ´æ£¬Ïà·´£¬¿ÉÖ´ĞĞÎÄ¼şÖ»ÊÇ±»Á¬½Ó<span class=GramE>µ½½ø³Ì</span>µÄĞéÄâµØÖ·¿Õ¼äÖĞ¡£Ëæ×Å³ÌĞòµÄÔËĞĞ£¬±»ÒıÓÃµÄ³ÌĞò²¿·Ö»áÓÉ²Ù×÷ÏµÍ³×°Èëµ½ÎïÀíÄÚ´æ£¬ÕâÖÖ½«<span
class=GramE>Ó³Ïó</span>Á´½Óµ½½ø³ÌµØÖ·¿Õ¼äµÄ·½·¨±»³ÆÎª¡°ÄÚ´æÓ³Éä¡±¡£<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-family:ËÎÌå;
mso-hansi-font-family:"Times New Roman";color:black;mso-font-kerning:0pt'>µ±¿ÉÖ´ĞĞ<span
class=GramE>Ó³Ïó</span>Ó³Éä<span class=GramE>µ½½ø³Ì</span>µÄĞéÄâµØÖ·¿Õ¼äÊ±£¬½«²úÉúÒ»×é<span
lang=EN-US> vm_area_struct </span>½á¹¹À´ÃèÊöĞéÄâÄÚ´æÇø¼äµÄÆğÊ¼µãºÍÖÕÖ¹µã£¬Ã¿¸ö<span lang=EN-US>
vm_area_struct </span>½á¹¹´ú±í¿ÉÖ´ĞĞ<span class=GramE>Ó³Ïó</span>µÄÒ»²¿·Ö£¬¿ÉÄÜÊÇ¿ÉÖ´ĞĞ´úÂë£¬Ò²¿ÉÄÜÊÇ³õÊ¼»¯µÄ±äÁ¿»òÎ´³õÊ¼»¯µÄÊı¾İ£¬ÕâĞ©¶¼ÊÇÔÚº¯Êı<span
lang=EN-US>do_mmap()</span>ÖĞÀ´ÊµÏÖµÄ¡£Ëæ×Å<span lang=EN-US> vm_area_struct </span>½á¹¹µÄÉú³É£¬ÕâĞ©½á¹¹ËùÃèÊöµÄĞéÄâÄÚ´æÇø¼äÉÏµÄ±ê×¼²Ù×÷º¯ÊıÒ²ÓÉ<span
lang=EN-US> Linux </span>³õÊ¼»¯¡£µ«ÒªÃ÷È·ÔÚÕâÒ»²½»¹Ã»ÓĞ½¨Á¢´ÓĞéÄâÄÚ´æµ½ÎïÀíÄÚ´æµÄÓ°Éä£¬Ò²¾ÍÊÇËµ»¹Ã»ÓĞ½¨Á¢Ò³±íÒ³Ä¿Â¼¡£<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-family:ËÎÌå;
mso-hansi-font-family:"Times New Roman";color:black;mso-font-kerning:0pt'>ÎªÁË¶ÔÉÏÃæµÄÔ­Àí½øĞĞ¾ßÌåµÄËµÃ÷£¬ÎÒÃÇÀ´¿´Ò»ÏÂ<span
lang=EN-US>do_mmap()</span>µÄÊµÏÖ»úÖÆ¡£<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-family:ËÎÌå;
mso-hansi-font-family:"Times New Roman";color:black;mso-font-kerning:0pt'>º¯Êı<span
lang=EN-US>do_mmap()</span>Îªµ±Ç°½ø³Ì´´½¨²¢³õÊ¼»¯Ò»¸öĞÂµÄĞéÄâÇø£¬Èç¹û·ÖÅä³É¹¦£¬¾Í°ÑÕâ¸öĞÂµÄĞéÄâÇøÓë½ø³ÌÒÑÓĞµÄÆäËûĞéÄâÇø½øĞĞºÏ²¢£¬<span
lang=EN-US>do_mmap()</span>ÔÚ<span lang=EN-US>include/linux/mm.h </span>ÖĞ¶¨ÒåÈçÏÂ£º<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span class=GramE><span
lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";
color:black;mso-font-kerning:0pt'>static</span></span><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'> inline unsigned long do_mmap(struct file *file, unsigned
long addr,<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>unsigned</span> long len, unsigned long prot,<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>unsigned</span> long flag, unsigned long offset)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>{<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>unsigned</span> long ret = -EINVAL;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> ((offset + PAGE_ALIGN(len)) &lt; offset)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>goto</span> out;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (!(offset &amp; ~PAGE_MASK))<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>ret</span> = do_mmap_pgoff(file, addr, len, prot,
flag, offset &gt;&gt; PAGE_SHIFT);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span class=GramE><span
lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";
color:black;mso-font-kerning:0pt'>out</span></span><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> ret;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>}<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-family:ËÎÌå;
mso-hansi-font-family:"Times New Roman";color:black;mso-font-kerning:0pt'>º¯ÊıÖĞ²ÎÊıµÄº¬ÒåÈçÏÂ£º<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>file</span><span style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'>£º±íÊ¾ÒªÓ³ÉäµÄÎÄ¼ş£¬<span lang=EN-US>file</span>½á¹¹½«ÔÚµÚ°ËÕÂÎÄ¼şÏµÍ³ÖĞ½øĞĞ½éÉÜ£»<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='margin-left:24.0pt;text-align:left;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>off</span><span style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'>£ºÎÄ¼şÄÚµÄÆ«ÒÆÁ¿£¬ÒòÎªÎÒÃÇ²¢²»ÊÇÒ»ÏÂ×ÓÈ«²¿Ó³ÉäÒ»¸öÎÄ¼ş£¬¿ÉÄÜÖ»ÊÇÓ³ÉäÎÄ¼şµÄÒ»²¿·Ö£¬<span
lang=EN-US>off</span>¾Í±íÊ¾ÄÇ²¿·ÖµÄÆğÊ¼Î»ÖÃ£»<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>len</span><span style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'>£ºÒªÓ³ÉäµÄÎÄ¼ş²¿·ÖµÄ³¤¶È<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>addr</span><span style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'>£ºĞéÄâ¿Õ¼äÖĞµÄÒ»¸öµØÖ·£¬±íÊ¾´ÓÕâ¸öµØÖ·¿ªÊ¼²éÕÒÒ»¸ö¿ÕÏĞµÄĞéÄâÇø£»<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:24.0pt;mso-layout-grid-align:none;
text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'>prot:</span><span
lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";
color:black'> </span><span style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";
color:black'>Õâ¸ö²ÎÊıÖ¸¶¨¶ÔÕâ¸öĞéÄâÇøËù°üº¬Ò³µÄ´æÈ¡È¨ÏŞ¡£¿ÉÄÜµÄ±êÖ¾ÓĞ<span lang=EN-US>PROT_READ</span>¡¢<span
lang=EN-US>PROT_WRITE</span>¡¢<span lang=EN-US>PROT_EXEC</span>ºÍ<span
lang=EN-US>PROT_NONE</span>¡£Ç°Èı¸ö±êÖ¾Óë±êÖ¾<span lang=EN-US>VM_READ</span>¡¢<span
lang=EN-US>VM_WRITE </span>¼°<span lang=EN-US>VM_EXEC</span>µÄÒâÒåÒ»Ñù¡£<span
lang=EN-US>PROT_NONE</span>±íÊ¾½ø³ÌÃ»ÓĞÒÔÉÏÈı¸ö´æÈ¡È¨ÏŞÖĞµÄÈÎÒâÒ»¸ö¡£<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";
color:black'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span>Flag</span><span
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black'>£ºÕâ¸ö²ÎÊıÖ¸¶¨ĞéÄâÇøµÄÆäËü±êÖ¾£º<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-indent:21.0pt;mso-layout-grid-align:none;
text-autospace:none'><span lang=EN-US style='color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-indent:36.0pt;mso-outline-level:1;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black'>MAP_GROWSDOWN</span><span style='font-family:
ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black'>£¬<span lang=EN-US>MAP_LOCKED</span>£¬<span
lang=EN-US>MAP_DENYWRITE</span>ºÍ<span lang=EN-US>MAP_EXECUTABLE </span>£º<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-indent:21.0pt;mso-layout-grid-align:
none;text-autospace:none'><span style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black'>ËüÃÇµÄº¬ÒåÓë±í<span lang=EN-US>6.2</span>ÖĞËùÁĞ³ö±êÖ¾µÄº¬ÒåÏàÍ¬¡£<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-indent:36.0pt;mso-outline-level:1;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black'>MAP_SHARED </span><span style='font-family:ËÎÌå;
mso-hansi-font-family:"Times New Roman";color:black'>ºÍ<span lang=EN-US>
MAP_PRIVATE </span>£º<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:42.0pt;mso-layout-grid-align:none;
text-autospace:none'><span style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";
color:black'>Ç°Ò»¸ö±êÖ¾Ö¸¶¨ĞéÄâÇøÖĞµÄ<span class=GramE>Ò³¿ÉÒÔ</span>±»Ğí¶à½ø³Ì¹²Ïí£»ºóÒ»¸ö±êÖ¾×÷ÓÃÏà·´¡£ÕâÁ½¸ö±êÖ¾¶¼Éæ¼°<span
lang=EN-US>vm_area_struct</span>ÖĞµÄ<span lang=EN-US>VM_SHARED</span>±êÖ¾¡£</span><span
lang=EN-US style='color:black'><o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:36.0pt;mso-outline-level:1;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black'>MAP_ANONYMOUS<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-indent:21.0pt;mso-layout-grid-align:
none;text-autospace:none'><span style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black'>±íÊ¾Õâ¸öĞéÄâÇøÊÇÄäÃûµÄ£¬ÓëÈÎºÎÎÄ¼şÎŞ¹Ø¡£</span><span lang=EN-US
style='color:black'><o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:36.0pt;mso-outline-level:1;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black'>MAP_FIXED <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-indent:21.0pt;mso-layout-grid-align:
none;text-autospace:none'><span style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black'>Õâ¸öÇø¼äµÄÆğÊ¼µØÖ·±ØĞëÊÇÓÉ²ÎÊı<span lang=EN-US>addr</span>ËùÖ¸¶¨µÄ¡£</span><span
lang=EN-US style='color:black'><o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:36.0pt;mso-outline-level:1;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black'>MAP_NORESERVE <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:21.0pt;text-indent:21.0pt;mso-layout-grid-align:
none;text-autospace:none'><span style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black'>º¯Êı²»±ØÔ¤ÏÈ¼ì²é¿ÕÏĞÒ³ÃæµÄÊıÄ¿¡£</span><span lang=EN-US
style='color:black'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:19.2pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>do_mmap()</span><span style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'>º¯Êı¶Ô²ÎÊı<span lang=EN-US>offset</span>µÄºÏ·¨ĞÔ¼ì²éºó£¬¾Íµ÷ÓÃ<span
lang=EN-US>do_mmap_pgoff</span>£¨£©º¯Êı£¬¸Ãº¯Êı²ÅÊÇÄÚ´æÓ³ÉäµÄÖ÷Òªº¯Êı£¬<span lang=EN-US>do_mmap_pgoff</span>£¨£©µÄ´úÂëÔÚ<span
lang=EN-US>mm/mmap.c</span>ÖĞ£¬´úÂë±È½Ï³¤£¬ÎÒÃÇ·Ö¶ÎÀ´½éÉÜ£º<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:19.2pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span class=GramE><span lang=EN-US style='font-family:
ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;mso-font-kerning:0pt'>unsigned</span></span><span
lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";
color:black;mso-font-kerning:0pt'> long do_mmap_pgoff(struct file * file,
unsigned long addr, unsigned long len,<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>unsigned</span> long prot, unsigned long flags,
unsigned long pgoff)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'>{<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>struct</span> mm_struct * mm = current-&gt;mm;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>struct</span> vm_area_struct * vma, * prev;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>unsigned</span> int vm_flags;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>int</span> correct_wcount = 0;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>int</span> error;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>rb_node_t ** rb_link, * rb_parent;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (file &amp;&amp; (!file-&gt;f_op ||
!file-&gt;f_op-&gt;mmap))<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> -ENODEV;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> ((len = PAGE_ALIGN(len)) == 0)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> addr;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;</span><span class=GramE>if</span> (len &gt;
TASK_SIZE)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> -EINVAL;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*
offset overflow? */<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> ((pgoff + (len &gt;&gt; PAGE_SHIFT)) &lt;
pgoff)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> -EINVAL;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/* <span
class=GramE>Too</span> many mappings? */<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (mm-&gt;map_count &gt; MAX_MAP_COUNT)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
class=GramE>return</span> -ENOMEM;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='margin-left:5.4pt;text-align:left;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'><span style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span><span
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>º¯ÊıÊ×ÏÈ¼ì²é²ÎÊıµÄÖµÊÇ·ñÕıÈ·£¬ËùÌáµÄÇëÇóÊÇ·ñÄÜ¹»±»Âú×ã£¬Èç¹û·¢ÉúÒÔÉÏÇé¿öÖĞµÄÈÎºÎÒ»ÖÖ£¬<span
lang=EN-US>do_mmap()</span>º¯Êı¶¼ÖÕÖ¹²¢·µ»ØÒ»¸ö¸ºÖµ¡£<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp; </span>/* <span class=GramE>Obtain</span> the
address to map to. <span class=GramE>we</span> verify (or select) it and ensure<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>* <span class=GramE>that</span>
it represents a valid section of the address space.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>*/<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>addr</span> = get_unmapped_area(file, addr, len, pgoff, flags);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (addr &amp; ~PAGE_MASK)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> addr;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>µ÷ÓÃ<span lang=EN-US>get_unmapped_area</span>£¨£©º¯ÊıÔÚµ±Ç°½ø³ÌµÄÓÃ»§¿Õ¼äÖĞ»ñµÃÒ»¸öÎ´Ó³ÉäÇø¼äµÄÆğÊ¼µØÖ·¡£<span
lang=EN-US>PAGE_MASK</span>µÄÖµÎª<span lang=EN-US>0xFFFFF000</span>£¬Òò´Ë£¬Èç¹û¡°<span
lang=EN-US>addr &amp; ~PAGE_MASK</span>¡±Îª·Ç<span lang=EN-US>0</span>£¬ËµÃ÷<span
lang=EN-US>addr</span>×îµÍ<span lang=EN-US>12</span>Î»·Ç<span lang=EN-US>0</span>£¬<span
lang=EN-US>addr</span>¾Í²»ÊÇÒ»¸öÓĞĞ§µÄµØÖ·£¬¾ÍÒÔÕâ¸öµØÖ·×÷Îª·µ»ØÖµ£»·ñÔò£¬<span lang=EN-US>addr</span>¾ÍÊÇÒ»¸öÓĞĞ§µÄµØÖ·£¨×îµÍ<span
lang=EN-US>12</span>Î»Îª<span lang=EN-US>0</span>£©£¬¼ÌĞøÏòÏÂ¿´£º<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:36.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>/* Do simple checking here so the lower-level routines
won't have<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:36.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>* <span class=GramE>to</span>. <span class=GramE>we</span>
assume access permissions have been handled by the open<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:36.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>* <span class=GramE>of</span> the memory object, so we
don't do any here.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:36.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>*/<o:p></o:p></span></p>

<p class=MsoNormal align=left style='margin-left:36.0pt;text-align:left;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;
mso-font-kerning:0pt'>vm_flags = calc_vm_<span class=GramE>flags(</span>prot,flags)
| mm-&gt;def_flags | VM_MAYREAD | VM_MAYWRITE | VM_MAYEXEC;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>/* mlock MCL_FUTURE? */<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (vm_flags &amp; VM_LOCKED) {<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>unsigned</span> long locked = mm-&gt;locked_vm
&lt;&lt; PAGE_SHIFT;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>locked</span> += len;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (locked &gt;
current-&gt;rlim[RLIMIT_MEMLOCK].rlim_cur)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> -EAGAIN;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span><span style='font-family:
ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;mso-font-kerning:0pt'>Èç¹û</span><span
lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black'>flag</span><span
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black'>²ÎÊıÖ¸¶¨µÄĞÂĞéÄâÇøÖĞµÄ<span
class=GramE>Ò³±ØĞë</span>ËøÔÚÄÚ´æ£¬<span class=GramE>ÇÒ½ø³Ì</span>¼ÓËøÒ³µÄ×ÜÊı³¬¹ıÁË±£´æÔÚ½ø³ÌµÄ<span
lang=EN-US>task_struct</span>½á¹¹<span lang=EN-US>rlim[RLIMIT_MEMLOCK].rlim_cur</span>ÓòÖĞµÄÉÏÏŞÖµ£¬Ôò·µ»ØÒ»¸ö¸ºÖµ£¬¼ÌĞø£º<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span
class=GramE>if</span> (file) {<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>switch</span> (flags &amp; MAP_TYPE) {<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>case</span> MAP_SHARED:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
class=GramE>if</span> ((prot &amp; PROT_WRITE) &amp;&amp; !(file-&gt;f_mode
&amp; FMODE_WRITE))<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> -EACCES;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>/* Make sure we don't allow writing to an append-only file<span
class=GramE>..</span> */<o:p></o:p></span></p>

<p class=MsoNormal align=left style='margin-left:144.0pt;text-align:left;
mso-layout-grid-align:none;text-autospace:none'><span class=GramE><span
lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black'>if</span></span><span
lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black'>
(IS_APPEND(file-&gt;f_dentry-&gt;d_inode) &amp;&amp; (file-&gt;f_mode &amp; <span
style='mso-spacerun:yes'>&nbsp;&nbsp;</span>FMODE_WRITE))<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> -EACCES;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>/* make sure there are no mandatory locks on the file. */<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span>
(locks_verify_locked(file-&gt;f_dentry-&gt;d_inode))<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
class=GramE>return</span> -EAGAIN;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>vm_flags |= VM_SHARED | VM_MAYSHARE;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (!(file-&gt;f_mode &amp; FMODE_WRITE))<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>vm_flags &amp;= <span class=GramE>~(</span>VM_MAYWRITE | VM_SHARED);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>/* fall through */<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>case</span> MAP_PRIVATE:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (!(file-&gt;f_mode &amp; FMODE_READ))<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> -EACCES;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>default</span>:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> -EINVAL;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp;</span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>}<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}
else {<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>vm_flags |= VM_SHARED | VM_MAYSHARE;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>switch</span> (flags &amp; MAP_TYPE) {<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>default</span>:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> -EINVAL;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>case</span> MAP_PRIVATE:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>vm_flags &amp;= <span class=GramE>~(</span>VM_SHARED | VM_MAYSHARE);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>/* fall through */<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>case</span> MAP_SHARED:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>}<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'>Èç¹û<span lang=EN-US>file</span>½á¹¹Ö¸ÕëÎª<span lang=EN-US>0</span>£¬ÔòÄ¿µÄ½öÔÚÓÚ´´½¨ĞéÄâÇø¼ä£¬»òÕßËµ£¬²¢Ã»ÓĞÕæÕıµÄÓ³Éä·¢Éú£»Èç¹û<span
lang=EN-US>file</span>½á¹¹Ö¸Õë²»Îª<span lang=EN-US>0</span>£¬ÔòÄ¿µÄÔÚÓÚ½¨Á¢´ÓÎÄ¼şµ½ĞéÄâÇø¼äµÄÓ³Éä£¬ÄÇ¾ÍÒª¸ù¾İ±êÖ¾Ö¸¶¨µÄÓ³ÉäÖÖÀà£¬°ÑÎªÎÄ¼şÉèÖÃµÄ·ÃÎÊÈ¨¿¼ÂÇ½øÈ¥£º<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='margin-left:21.25pt;text-align:left;
text-indent:-21.25pt;mso-list:l3 level1 lfo1;tab-stops:list 21.25pt;mso-layout-grid-align:
none;text-autospace:none'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå;color:black'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'>Èç¹ûËùÇëÇóµÄÄÚ´æÓ³ÉäÊÇ¹²Ïí¿ÉĞ´µÄ£¬¾ÍÒª¼ì²éÒªÓ³ÉäµÄÎÄ¼şÊÇÎªĞ´Èë¶ø´ò¿ªµÄ£¬¶ø²»ÊÇÒÔ×·¼ÓÄ£Ê½´ò¿ªµÄ£¬»¹Òª¼ì²éÎÄ¼şÉÏÃ»ÓĞÇ¿ÖÆËø¡£<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='margin-left:21.25pt;text-align:left;
text-indent:-21.25pt;mso-list:l3 level1 lfo1;tab-stops:list 21.25pt;mso-layout-grid-align:
none;text-autospace:none'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå;color:black'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'>¶ÔÓÚÈÎºÎÖÖÀàµÄÄÚ´æÓ³Éä£¬¶¼Òª¼ì²éÎÄ¼şÊÇÎª¶Á²Ù×÷¶ø´ò¿ªµÄ¡£<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp;</span></span><span
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black'>Èç¹ûÒÔÉÏÌõ¼ş¶¼²»Âú×ã£¬¾Í·µ»ØÒ»¸ö´íÎóÂë¡£<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'>/* Clear old maps */<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>error</span> = -ENOMEM;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'>munmap_back:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>vma</span> = find_vma_prepare(mm, addr, &amp;prev,
&amp;rb_link, &amp;rb_parent);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (vma &amp;&amp; vma-&gt;vm_start &lt; addr +
len) {<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (do_munmap(mm, addr, len))<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> -ENOMEM;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>goto</span> munmap_back;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>}<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span><span
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black'>º¯Êı<span
lang=EN-US>find_vma_prepare</span>£¨£©Óë<span lang=EN-US>find_vma</span>£¨£©»ù±¾ÏàÍ¬£¬ËüÉ¨Ãèµ±Ç°½ø³ÌµØÖ·¿Õ¼äµÄ<span
lang=EN-US>vm_area_struct</span>½á¹¹ËùĞÎ³ÉµÄºìºÚÊ÷£¬ÊÔÍ¼ÕÒµ½½áÊøµØÖ·¸ßÓÚ<span lang=EN-US>addr</span>µÄµÚÒ»¸öÇø¼ä£»Èç¹ûÕÒµ½ÁËÒ»¸öĞéÄâÇø£¬ËµÃ÷<span
lang=EN-US>addr</span>ËùÔÚµÄĞéÄâÇøÒÑ¾­ÔÚÊ¹ÓÃ£¬Ò²¾ÍÊÇÒÑ¾­ÓĞÓ³Éä´æÔÚ£¬Òò´ËÒªµ÷ÓÃ<span lang=EN-US>do_munmap</span>£¨£©°ÑÕâ¸öÀÏµÄĞéÄâÇø<span
class=GramE>´Ó½ø³Ì</span>µØÖ·¿Õ¼äÖĞ³·Ïú£¬Èç¹û³·Ïú²»³É¹¦£¬¾Í·µ»ØÒ»¸ö¸ºÊı£»Èç¹û³·Ïú³É¹¦£¬¾Í¼ÌĞø²éÕÒ£¬Ö±µ½ÔÚºìºÚÊ÷ÖĞÕÒ²»µ½<span
lang=EN-US>addr</span>ËùÔÚµÄĞéÄâÇø£¬²¢¼ÌĞøÏÂÃæµÄ¼ì²é£»<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;
</span>/* Check against address space limit. */<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> ((mm-&gt;total_vm &lt;&lt; PAGE_SHIFT) + len<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>&gt; current-&gt;<span class=GramE>rlim[</span>RLIMIT_AS].rlim_cur)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> -ENOMEM;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:19.2pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black'>total_vm</span><span
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black'>ÊÇ±íÊ¾½ø³ÌµØÖ·¿Õ¼äµÄÒ³ÃæÊı£¬Èç¹û°ÑÎÄ¼şÓ³Éä<span
class=GramE>µ½½ø³Ì</span>µØÖ·¿Õ¼äºó£¬Æä³¤¶È³¬¹ıÁË±£´æÔÚµ±Ç°½ø³Ì<span lang=EN-US>rlim[RLIMIT_AS].rlim_cur</span>ÖĞµÄÉÏÏŞÖµ£¬Ôò·µ»ØÒ»¸ö¸ºÊı¡£<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;
</span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>/*
Private writable mapping? Check memory availability<span class=GramE>..</span>
*/<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> ((vm_flags &amp; (VM_SHARED | VM_WRITE)) ==
VM_WRITE &amp;&amp;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>!(</span>flags &amp; MAP_NORESERVE)
&amp;&amp;!vm_enough_memory(len &gt;&gt; PAGE_SHIFT))<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> -ENOMEM;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;
color:black'>Èç¹û<span lang=EN-US>flags</span>²ÎÊıÖĞÃ»ÓĞÉèÖÃ<span lang=EN-US>MAP_NORESERVE</span>±êÖ¾£¬ĞÂµÄĞéÄâÇøº¬ÓĞË½ÓĞµÄ¿ÉĞ´Ò³£¬¿ÕÏĞÒ³ÃæÊıĞ¡ÓÚÒªÓ³ÉäµÄĞéÄâÇøµÄ´óĞ¡£»Ôòº¯ÊıÖÕÖ¹²¢·µ»ØÒ»¸ö¸ºÊı£»ÆäÖĞº¯Êı<span
lang=EN-US>vm_enough_memory</span>£¨£©ÓÃÀ´¼ì²éÒ»¸ö½ø³ÌµÄµØÖ·¿Õ¼äÖĞÊÇ·ñÓĞ×ã¹»µÄÄÚ´æÀ´½øĞĞÒ»¸öĞÂµÄÓ³Éä¡£<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>/*
Can we just expand an old anonymous mapping? */<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (!file &amp;&amp; !(vm_flags &amp; VM_SHARED) &amp;&amp;
rb_parent)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (vma_merge(mm, prev, rb_parent, addr, addr +
len, vm_flags))<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>goto</span> out;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span><span
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black'>Èç¹ûÊÇÄäÃûÓ³Éä£¨<span
lang=EN-US>file</span>Îª¿Õ£©£¬²¢ÇÒÕâ¸öĞéÄâÇøÊÇ·Ç¹²ÏíµÄ£¬Ôò¿ÉÒÔ°ÑÕâ¸öĞéÄâÇøºÍÓëËü½ô°¤µÄÇ°Ò»¸öĞéÄâÇø½øĞĞºÏ²¢£»ĞéÄâÇøµÄºÏ²¢ÊÇÓÉ<span
lang=EN-US>vma_merge()</span>º¯ÊıÊµÏÖµÄ¡£Èç¹ûºÏ²¢³É¹¦£¬Ôò×ª<span lang=EN-US>out</span>´¦£¬Çë¿´ºóÃæ<span
lang=EN-US>out</span>´¦µÄ´úÂë¡£<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/* <span
class=GramE>Determine</span> the object being mapped and call the appropriate<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>* <span class=GramE>specific</span> mapper. <span class=GramE>the</span>
address has already been validated, but<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-spacerun:yes'>&nbsp;</span>* <span class=GramE>not</span>
unmapped, but the maps are removed from the list.<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>*/<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>vma</span> = kmem_cache_alloc(vm_area_cachep,
SLAB_KERNEL);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (!vma)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-spacerun:yes'>&nbsp;&nbsp;</span><span class=GramE>return</span>
-ENOMEM;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>vma</span>-&gt;vm_mm = mm;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>vma</span>-&gt;vm_start = addr;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span style='mso-spacerun:yes'>&nbsp;</span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>vma</span>-&gt;vm_end = addr + len;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=PT-BR style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black;mso-ansi-language:PT-BR'>vma-&gt;vm_flags = vm_flags;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=PT-BR style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black;mso-ansi-language:PT-BR'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=GramE><span lang=EN-US style='font-family:ËÎÌå;
mso-hansi-font-family:Wingdings;color:black'>vma</span></span><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black'>-&gt;vm_page_prot
= protection_map[vm_flags &amp; 0x<st1:chmetcnv UnitName="F" SourceValue="0"
HasSpace="False" Negative="False" NumberType="1" TCSC="0" w:st="on">0f</st1:chmetcnv>];<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>vma</span>-&gt;vm_ops = NULL;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>vma</span>-&gt;vm_pgoff = pgoff;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=PT-BR style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black;
mso-ansi-language:PT-BR'>vma-&gt;vm_file = NULL;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=PT-BR style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black;mso-ansi-language:PT-BR'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>vma-&gt;vm_private_data = NULL;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=PT-BR style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black;mso-ansi-language:PT-BR'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>vma-&gt;vm_raend
= 0;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=PT-BR style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black;mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=PT-BR style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black;mso-ansi-language:PT-BR'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span><span style='font-family:
ËÎÌå;mso-hansi-font-family:Wingdings;color:black'>¾­¹ıÒÔÉÏ¸÷ÖÖ¼ì²éºó</span><span
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black;mso-ansi-language:
PT-BR'>£¬</span><span style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;
color:black'>ÏÖÔÚ±ØĞëÎªĞÂµÄĞéÄâÇø·ÖÅäÒ»¸ö</span><span lang=PT-BR style='font-family:ËÎÌå;
mso-hansi-font-family:Wingdings;color:black;mso-ansi-language:PT-BR'>vm_area_struct</span><span
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;color:black'>½á¹¹¡£ÕâÊÇÍ¨¹ıµ÷ÓÃ<span
lang=EN-US>Slab</span>·ÖÅäº¯Êı<span lang=EN-US>kmem_cache_alloc</span>£¨£©À´ÊµÏÖµÄ£¬È»ºó¾Í¶ÔÕâ¸ö½á¹¹µÄ¸÷¸öÓò½øĞĞÁË³õÊ¼»¯¡£<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:
Wingdings;color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
class=GramE>if</span> (file) {<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>error</span> = -EINVAL;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (vm_flags &amp; (VM_GROWSDOWN|VM_GROWSUP))<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>goto</span> free_vma;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (vm_flags &amp; VM_DENYWRITE) {<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>error</span> = deny_write_access(file);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (error)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
class=GramE>goto</span> free_vma;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>correct_wcount = 1;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>}<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>vma</span>-&gt;vm_file = file;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>get_<span class=GramE>file(</span>file);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>error</span> = file-&gt;f_op-&gt;mmap(file, vma);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (error)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
class=GramE>goto</span> unmap_and_free_vma;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-outline-level:1;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}
else if (flags &amp; MAP_SHARED) {<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=PT-BR style='color:black;mso-ansi-language:PT-BR'>error
= shmem_zero_setup(vma);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=PT-BR style='color:black;mso-ansi-language:
PT-BR'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=GramE><span lang=EN-US style='color:black'>if</span></span><span
lang=EN-US style='color:black'> (error)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>goto</span> free_vma;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>}<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'>free_vma:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>kmem_cache_<span class=GramE>free(</span>vm_area_cachep, vma);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>return</span> error;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'>}<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:black'>Èç¹û½¨Á¢µÄÊÇ´ÓÎÄ¼şµ½Ğé´æÇø¼äµÄÓ³Éä£¬Ôò£º</span><span lang=EN-US style='color:black'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='margin-left:21.25pt;text-align:left;
text-indent:-21.25pt;mso-list:l2 level1 lfo2;tab-stops:list 21.25pt;mso-layout-grid-align:
none;text-autospace:none'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå;color:black'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:black'>µ±²ÎÊı</span><span
lang=EN-US style='color:black'>flags</span><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:black'>ÖĞµÄ</span><span lang=EN-US style='color:black'>VM_GROWSDOWN</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:black'>»ò</span><span lang=EN-US style='color:black'>VM_GROWSUP</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:black'>±êÖ¾Î»Îª</span><span lang=EN-US style='color:black'>1</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:black'>Ê±£¬ËµÃ÷Õâ¸öÇø¼ä¿ÉÒÔÏòµÍµØÖ·»ò¸ßµØÖ·À©Õ¹£¬µ«´ÓÎÄ¼şÓ³ÉäµÄÇø¼ä²»ÄÜ½øĞĞÀ©Õ¹£¬Òò´Ë×ªµ½</span><span
lang=EN-US style='color:black'>free_vma</span><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:black'>£¬ÊÍ·Å¸ø</span><span lang=EN-US style='color:black'>vm_area_struct</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:black'>·ÖÅäµÄ</span><span lang=EN-US style='color:black'>Slab</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:black'>£¬²¢·µ»ØÒ»¸ö´íÎó£»</span><span lang=EN-US
style='color:black'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='margin-left:21.25pt;text-align:left;
text-indent:-21.25pt;mso-list:l2 level1 lfo2;tab-stops:list 21.25pt;mso-layout-grid-align:
none;text-autospace:none'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå;color:black'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:black'>µ±</span><span
lang=EN-US style='color:black'>flags</span><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:black'>ÖĞµÄ</span><span lang=EN-US style='color:black'>VM_DENYWRITE</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:black'>±êÖ¾Î»Îª</span><span lang=EN-US style='color:black'>1</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:black'>Ê±£¬¾Í±íÊ¾²»ÔÊĞíÍ¨¹ı³£¹æµÄÎÄ¼ş²Ù×÷·ÃÎÊ¸ÃÎÄ¼ş£¬ËùÒÔÒªµ÷ÓÃ</span><span
lang=EN-US style='color:black'>deny_write_access</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:black'>£¨£©ÅÅ³â³£¹æµÄÎÄ¼ş²Ù×÷£¨²Î¼ûµÚ°ËÕÂ£©¡£</span><span lang=EN-US style='color:black'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='margin-left:21.25pt;text-align:left;
text-indent:-21.25pt;mso-list:l2 level1 lfo2;tab-stops:list 21.25pt;mso-layout-grid-align:
none;text-autospace:none'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå;color:black'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US style='color:black'>get_file</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:black'>£¨£©º¯ÊıµÄÖ÷Òª×÷ÓÃÊÇµİÔö</span><span lang=EN-US
style='color:black'>file</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:black'>½á¹¹ÖĞµÄ¹²Ïí¼ÆÊı£»</span><span
lang=EN-US style='color:black'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l0 level1 lfo3;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:black'>Ã¿¸öÎÄ¼şÏµÍ³¶¼ÓĞ¸ö</span><span
lang=EN-US style='color:black'>fiel_operation</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:black'>Êı¾İ½á¹¹£¬ÆäÖĞµÄº¯ÊıÖ¸Õë</span><span lang=EN-US style='color:black'>mmap</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:black'>Ìá¹©ÁËÓÃÀ´½¨Á¢´Ó¸ÃÀàÎÄ¼şµ½Ğé´æÇø¼ä½øĞĞÓ³ÉäµÄ²Ù×÷£¬ÕâÊÇ×î¾ßÓĞÊµÖÊÒâÒåµÄº¯Êı£»¶ÔÓÚ´ó²¿·ÖÎÄ¼şÏµÍ³£¬Õâ¸öº¯ÊıÎª</span><span
lang=EN-US>generic_file_mmap( )</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>º¯ÊıÊµÏÖµÄ£¬¸Ãº¯ÊıÖ´ĞĞÒÔÏÂ²Ù×÷£º</span></p>

<p class=MsoNormal style='margin-left:60.25pt;text-indent:-18.0pt;mso-list:
l5 level1 lfo6;tab-stops:list 60.25pt'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>(1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>³õÊ¼»¯</span><span lang=EN-US>vm_area_struct</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>½á¹¹ÖĞµÄ</span><span lang=EN-US>vm_ops</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>Óò¡£Èç¹û</span><span lang=EN-US>VM_SHARED</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>±êÖ¾Îª</span><span lang=EN-US>1</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£¬¾Í°Ñ¸ÃÓòÉèÖÃ³É</span><span
lang=EN-US>file_shared_mmap</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£¬·ñÔò¾Í°Ñ¸ÃÓòÉèÖÃ³É</span><span
lang=EN-US>file_private_mmap</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>¡£´ÓÄ³ÖÖÒâÒåÉÏËµ£¬Õâ¸ö²½ÖèËù×öµÄÊÂÇéÀàËÆÓÚ´ò¿ªÒ»¸öÎÄ¼ş²¢³õÊ¼»¯ÎÄ¼ş¶ÔÏóµÄ·½·¨¡£</span></p>

<p class=MsoNormal style='margin-left:60.25pt;text-indent:-18.0pt;mso-list:
l5 level1 lfo6;tab-stops:list 60.25pt'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>(2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>´ÓË÷Òı½ÚµãµÄ</span><span lang=EN-US>i_mode</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>Óò£¨²Î¼ûµÚ°ËÕÂ£©¼ì²éÒªÓ³ÉäµÄÎÄ¼şÊÇ·ñÊÇÒ»¸ö³£¹æÎÄ¼ş¡£Èç¹ûÊÇÆäËûÀàĞÍµÄÎÄ¼ş£¨ÀıÈçÄ¿Â¼»òÌ×½Ó×Ö£©£¬¾Í·µ»ØÒ»¸ö´íÎó´úÂë¡£</span></p>

<p class=MsoNormal style='margin-left:60.25pt;text-indent:-18.0pt;mso-list:
l5 level1 lfo6;tab-stops:list 60.25pt'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>(3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>´ÓË÷Òı½ÚµãµÄ</span><span lang=EN-US>i_op</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÓòÖĞ¼ì²éÊÇ·ñ¶¨ÒåÁË</span><span lang=EN-US>readpage( )</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>µÄË÷Òı½Úµã²Ù×÷¡£Èç¹ûÃ»ÓĞ¶¨Òå£¬¾Í·µ»ØÒ»¸ö´íÎó´úÂë¡£</span></p>

<p class=MsoNormal style='margin-left:60.25pt;text-indent:-18.0pt;mso-list:
l5 level1 lfo6;tab-stops:list 60.25pt'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>(4)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>µ÷ÓÃ</span><span lang=EN-US>update_atime( )</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>º¯Êı°Ñµ±Ç°Ê±¼ä´æ·ÅÔÚ¸ÃÎÄ¼şË÷Òı½ÚµãµÄ</span><span lang=EN-US>i_atime</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÓòÖĞ£¬²¢½«Õâ¸öË÷Òı½Úµã±ê¼Ç³ÉÔà¡£</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l1 level1 lfo4;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Èç¹û</span><span
lang=EN-US>flags</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>²ÎÊıÖĞµÄ</span><span lang=EN-US
style='color:black'>MAP_SHARED</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:black'>±êÖ¾Î»Îª</span><span
lang=EN-US style='color:black'>1</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:black'>£¬Ôòµ÷ÓÃ</span><span
lang=EN-US style='color:black'>shmem_zero_setup</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:black'>£¨£©½øĞĞ¹²ÏíÄÚ´æµÄÓ³Éä¡£</span></p>

<p class=MsoNormal><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:black'>¼ÌĞø¿´</span><span lang=EN-US style='color:black'>do_mmap()</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:black'>ÖĞµÄ´úÂë£»</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>/* Can addr have changed??</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>*</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>* Answer: Yes, several device drivers can do it in their</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>*<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>f_op-&gt;mmap method.</span> -DaveM</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>addr</span> = vma-&gt;vm_start;</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>Ô´Âë×÷Õß¸ø³öÁË½âÊÍ£¬ÒâË¼ÊÇËµ£¬</span><span lang=EN-US>addr</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÓĞ¿ÉÄÜÒÑ±»Çı¶¯³ÌĞò¸Ä±ä£¬Òò´Ë£¬°ÑĞÂĞéÄâÇøµÄÆğÊ¼µØÖ·¸³¸ø</span><span lang=EN-US>addr</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£»</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>vma_<span class=GramE>link(</span>mm, vma, prev, rb_link, rb_parent);</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (correct_wcount)</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>atomic_<span class=GramE>inc(</span>&amp;file-&gt;f_dentry-&gt;d_inode-&gt;i_writecount);</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span><span style='mso-spacerun:yes'>&nbsp;
</span></span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>´ËÊ±£¬Ó¦¸Ã°ÑĞÂ½¨µÄĞéÄâÇø²åÈë<span class=GramE>µ½½ø³Ì</span>µÄµØÖ·¿Õ¼ä£¬ÕâÊÇÓÉº¯Êı</span><span
lang=EN-US>vma_link</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£¨£©Íê³ÉµÄ£¬¸Ãº¯Êı¾ßÓĞÈı·½ÃæµÄ¹¦ÄÜ£º</span></p>

<p class=MsoNormal style='margin-left:33.6pt;text-indent:-24.0pt;mso-list:l4 level1 lfo5;
tab-stops:list 33.6pt'><![if !supportLists]><span lang=EN-US style='mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>£¨1£©<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>°Ñ</span><span
lang=EN-US>vma </span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>²åÈëµ½ĞéÄâÇøÁ´±íÖĞ</span></p>

<p class=MsoNormal style='margin-left:33.6pt;text-indent:-24.0pt;mso-list:l4 level1 lfo5;
tab-stops:list 33.6pt'><![if !supportLists]><span lang=EN-US style='mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>£¨2£©<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>°Ñ</span><span
lang=EN-US>vma</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>²åÈëµ½ĞéÄâÇøĞÎ³ÉµÄºìºÚÊ÷ÖĞ</span></p>

<p class=MsoNormal style='margin-left:33.6pt;text-indent:-24.0pt;mso-list:l4 level1 lfo5;
tab-stops:list 33.6pt'><![if !supportLists]><span lang=EN-US style='mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>£¨3£©<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>°Ñ</span><span
lang=EN-US>vam</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>²åÈëµ½Ë÷Òı½Úµã£¨</span><span lang=EN-US>inode</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£©¹²ÏíÁ´±íÖĞ</span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;</span></span><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:black'>º¯Êı</span><span lang=EN-US>atomic_inc</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£¨</span><span
lang=EN-US>x</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>£©¸ø</span><span lang=EN-US>*x</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>¼Ó</span><span lang=EN-US>1</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£¬ÕâÊÇÒ»¸öÔ­×Ó²Ù×÷¡£ÔÚÄÚºË´úÂëÖĞ£¬ÓĞºÜ¶àµØ·½µ÷ÓÃÁËÒÔ</span><span
lang=EN-US>atomic</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>ÎªÇ°×ºµÄº¯Êı¡£ËùÎ½Ô­×Ó²Ù×÷£¬¾ÍÊÇÔÚ²Ù×÷¹ı³ÌÖĞ²»»á±»ÖĞ¶Ï¡£</span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span class=GramE><span lang=EN-US>out</span></span><span
lang=EN-US>:<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>mm</span>-&gt;total_vm += len &gt;&gt; PAGE_SHIFT;</span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (vm_flags &amp; VM_LOCKED) {</span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>mm</span>-&gt;locked_vm += len &gt;&gt; PAGE_SHIFT;</span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>make_pages_<span class=GramE>present(</span>addr, addr + len);</span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>}</span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> addr;</span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>do_mmap()</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>º¯Êı×¼±¸´ÓÕâÀïÍË³ö£¬Ê×ÏÈÔö¼Ó½ø³ÌµØÖ·¿Õ¼äµÄ³¤¶È£¬È»ºó¿´Ò»ÏÂ¶ÔÕâ¸öÇø¼äÊÇ·ñ¼ÓËø£¬Èç¹û¼ÓËø£¬ËµÃ÷×¼±¸·ÃÎÊÕâ¸öÇø¼ä£¬¾ÍÒªµ÷ÓÃ</span><span
lang=EN-US>make_pages_present</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£¨£©º¯Êı£¬½¨Á¢ĞéÄâÒ³Ãæµ½ÎïÀíÒ³ÃæµÄÓ³Éä£¬Ò²¾ÍÊÇÍê³ÉÎÄ¼şµ½ÎïÀíÄÚ´æµÄÕæÕıµ÷Èë¡£·µ»ØÒ»¸öÕıÊı£¬ËµÃ÷Õâ´ÎÓ³Éä³É¹¦¡£</span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'>unmap_and_free_vma:<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (correct_wcount)<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>atomic_<span class=GramE>inc(</span>&amp;file-&gt;f_dentry-&gt;d_inode-&gt;i_writecount);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>vma</span>-&gt;vm_file = NULL;<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>fput(</span>file);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*
Undo any partial mapping done by a device driver. */<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>zap_page_<span class=GramE>range(</span>mm, vma-&gt;vm_start,
vma-&gt;vm_end - vma-&gt;vm_start);<o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:19.2pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:black'>Èç¹û¶ÔÎÄ¼şµÄ²Ù×÷²»³É¹¦£¬Ôò½â³ı¶Ô¸ÃĞéÄâÇø¼äµÄÒ³ÃæÓ³Éä£¬ÕâÊÇÓÉ</span><span lang=EN-US
style='color:black'>zap_page_range</span><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:black'>£¨£©º¯ÊıÍê³ÉµÄ¡£</span><span lang=EN-US style='color:black'><o:p></o:p></span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:black'>µ±Äã¶Áµ½ÕâÀïÊ±¿ÉÄÜ¸Ğµ½À§»ó£¬Ò³ÃæµÄÓ³Éäµ½µ×ÔÚºÎÊ±½¨Á¢£¿Êµ¼ÊÉÏ£¬</span><span lang=EN-US>generic_file_mmap(
)</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>¾ÍÊÇÕæÕı½øĞĞÓ³ÉäµÄº¯Êı¡£ÒòÎªÕâ¸öº¯ÊıµÄÊµÏÖÉæ¼°ºÜ¶àÎÄ¼şÏµÍ³µÄÄÚÈİ£¬ÎÒÃÇÔÚ´Ë²»½øĞĞÉîÈëµÄ·ÖÎö£¬µ±¶ÁÕßÁË½âÁËÎÄ¼şÏµÍ³µÄÓĞ¹ØÄÚÈİºó£¬¿É×Ô¼º½øĞĞ·ÖÎö¡£</span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÕâÀïÒªËµÃ÷µÄÊÇ£¬ÎÄ¼şµ½Ğé´æµÄÓ³Éä½ö½öÊÇ½¨Á¢ÁËÒ»ÖÖÓ³Éä¹ØÏµ£¬Ò²¾ÍÊÇËµ£¬Ğé´æÒ³Ãæµ½ÎïÀíÒ³ÃæÖ®¼äµÄÓ³Éä»¹Ã»ÓĞ½¨Á¢¡£µ±</span><span
class=GramE><span style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";
color:black;mso-font-kerning:0pt'>Ä³¸ö¿É</span></span><span style='font-family:
ËÎÌå;mso-hansi-font-family:"Times New Roman";color:black;mso-font-kerning:0pt'>Ö´ĞĞ<span
class=GramE>Ó³Ïó</span>Ó³Éä<span class=GramE>µ½½ø³Ì</span>ĞéÄâÄÚ´æÖĞ²¢¿ªÊ¼Ö´ĞĞÊ±£¬ÒòÎªÖ»ÓĞºÜÉÙÒ»²¿·ÖĞéÄâÄÚ´æÇø¼ä×°Èëµ½ÁËÎïÀíÄÚ´æ£¬¿ÉÄÜ»áÓöµ½Ëù·ÃÎÊµÄÊı¾İ²»ÔÚÎïÀíÄÚ´æ¡£ÕâÊ±£¬´¦ÀíÆ÷½«Ïò<span
lang=EN-US> Linux </span>±¨¸æÒ»¸öÒ³¹ÊÕÏ¼°Æä¶ÔÓ¦µÄ¹ÊÕÏÔ­Òò£¬ÓÚÊÇ¾ÍÓÃµ½<span class=GramE>ÁËÇëÒ³»úÖÆ</span>¡£<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

</div>

</body>


<!-- Mirrored from www.kerneltravel.net/kernel-book/ç¬¬å…­ç« %20Linuxå†…å­˜ç®¡ç†/6.4.3.htm by HTTrack Website Copier/3.x [XR&CO'2008], Sat, 29 Dec 2012 03:00:46 GMT -->
</html>
