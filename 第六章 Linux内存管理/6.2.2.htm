<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">


<!-- Mirrored from www.kerneltravel.net/kernel-book/ç¬¬å…­ç« %20Linuxå†…å­˜ç®¡ç†/6.2.2.htm by HTTrack Website Copier/3.x [XR&CO'2008], Sat, 29 Dec 2012 03:00:36 GMT -->
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="6.2.2.files/filelist.html">
<title>ÎïÀíÄÚ´æµÄÌ½²â</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="chsdate" downloadurl=""/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="chmetcnv" downloadurl=""/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>CLJ</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>CLJ</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>1</o:TotalTime>
  <o:Created>2007-08-15T07:45:00Z</o:Created>
  <o:LastSaved>2007-08-15T07:45:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>1143</o:Words>
  <o:Characters>6520</o:Characters>
  <o:Lines>54</o:Lines>
  <o:Paragraphs>15</o:Paragraphs>
  <o:CharactersWithSpaces>7648</o:CharactersWithSpaces>
  <o:Version>11.5606</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:GrammarState>Clean</w:GrammarState>
  <w:PunctuationKerning/>
  <w:DrawingGridVerticalSpacing>7.8 °õ</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:AdjustLineHeightInTable/>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:ËÎÌå;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:SimSun;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
@font-face
	{font-family:"\@ËÎÌå";
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	mso-pagination:none;
	font-size:10.5pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:ËÎÌå;
	mso-font-kerning:1.0pt;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
 /* Page Definitions */
 @page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:42.55pt;
	mso-footer-margin:49.6pt;
	mso-paper-source:0;
	layout-grid:15.6pt;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:37516803;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l1
	{mso-list-id:140462870;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l2
	{mso-list-id:293602761;
	mso-list-type:simple;
	mso-list-template-ids:1141306038;}
@list l2:level1
	{mso-level-text:£¨%1£©;
	mso-level-tab-stop:47.4pt;
	mso-level-number-position:left;
	margin-left:47.4pt;
	text-indent:-26.4pt;}
@list l3
	{mso-list-id:508525663;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l3:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l4
	{mso-list-id:551190140;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l4:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l5
	{mso-list-id:715276882;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l5:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l6
	{mso-list-id:752632494;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l6:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l7
	{mso-list-id:776408014;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l7:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l8
	{mso-list-id:881938132;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l8:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l9
	{mso-list-id:955019459;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l9:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l10
	{mso-list-id:1020935033;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l10:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l11
	{mso-list-id:1435058534;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l11:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l12
	{mso-list-id:1437212379;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l12:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l13
	{mso-list-id:1485973220;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l13:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l14
	{mso-list-id:1576207464;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l14:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l15
	{mso-list-id:1647926593;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l15:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l16
	{mso-list-id:1734695744;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l16:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l17
	{mso-list-id:1753775039;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l17:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l18
	{mso-list-id:1802646863;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l18:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:ÆÕÍ¨±í¸ñ;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=ZH-CN style='tab-interval:21.0pt;text-justify-trim:punctuation'>

<div class=Section1 style='layout-grid:15.6pt'>

<p class=MsoNormal style='mso-outline-level:1'><st1:chsdate Year="1899"
Month="12" Day="30" IsLunarDate="False" IsROCDate="False" w:st="on"><span
 lang=EN-US>6.2.2</span></st1:chsdate><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp; </span></span><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ÎïÀíÄÚ´æµÄÌ½²â</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ÎÒÃÇÖªµÀ£¬</span><span
lang=EN-US>BIOS</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>²»½öÄÜÒıµ¼²Ù×÷ÏµÍ³£¬»¹µ£¸º×Å¼Óµç×Ô¼ìºÍ¶Ô×ÊÔ´µÄÉ¨ÃèÌ½²â£¬ÆäÖĞ¾Í°üÀ¨ÁË¶ÔÎïÀíÄÚ´æµÄ×Ô¼ìºÍÉ¨Ãè£¨Äã¸Õ¿ª»úÊ±Ëù¿´µ½µÄĞÅÏ¢¾ÍÊÇ´Ë½×¶Î</span><span
lang=EN-US>BIOS</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>ÏÔÊ¾µÄĞÅÏ¢£©¡£¶ÔÓÚÕâ¸ö½×¶ÎÖĞ»ñµÃµÄÄÚ´æĞÅÏ¢¿ÉÒÔÍ¨¹ı</span><span
lang=EN-US>BIOS</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>µ÷ÓÃ¡°</span><span lang=EN-US>int 0x<st1:chmetcnv
UnitName="¡±" SourceValue="15" HasSpace="False" Negative="False" NumberType="1"
TCSC="0" w:st="on">15¡±</st1:chmetcnv></span><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>¼ÓÒÔ¼ì²é¡£ÓÉÓÚ</span><span
lang=EN-US>Linux</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>ÄÚºË²»ÄÜ×÷</span><span lang=EN-US>BIOS</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>µ÷ÓÃ£¬Òò´ËÄÚºË±¾Éí¾ÍµÃ´úÎª¼ì²é£¬²¢¸ù¾İ»ñµÃµÄĞÅÏ¢Éú³ÉÒ»·ùÎïÀíÄÚ´æ¹¹³ÉÍ¼£¬Õâ¾ÍÊÇÉÏÃæËù½éÉÜµÄ</span><span
lang=EN-US>e820</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>Í¼£¬È»ºóÍ¨¹ıÉÏÃæÌáµ½µÄ²ÎÊı¿é´«¸øÄÚºË¡£Ê¹µÃÄÚºËÄÜÖªµÀÏµÍ³ÖĞÄÚ´æ×ÊÔ´µÄÅäÖÃ¡£Ö®ËùÒÔ³ÆÎª</span><span
lang=EN-US>e820</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>Í¼£¬ÊÇÒòÎªÔÚÍ¨¹ı<span class=GramE>¡±</span></span><span
lang=EN-US>int 0x<st1:chmetcnv UnitName="¡±" SourceValue="15" HasSpace="False"
Negative="False" NumberType="1" TCSC="0" w:st="on">15<span class=GramE>¡±</span></st1:chmetcnv></span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>²éÑ¯ÄÚ´æµÄ¹¹³ÉÊ±Òª°Ñµ÷ÓÃ²ÎÊıÖ®Ò»ÉèÖÃ³É</span><span lang=EN-US>0xe820</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>¡£</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>·Ö<span
class=GramE>Ò³»úÖÆ</span>ÆôÓÃÒÔºó£¬ÓëÄÚ´æ¹ÜÀíÏà¹ØµÄ²Ù×÷¾ÍÊÇµ÷ÓÃ</span><span lang=EN-US>init/main.c</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÖĞµÄ</span><span lang=EN-US>start_kernel</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¨£©º¯Êı£¬</span><span lang=EN-US>start_kernel</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¨£©º¯ÊıÒªµ÷ÓÃÒ»¸ö½Ğ</span><span lang=EN-US>setup_arch()</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>µÄº¯Êı£¬</span><span lang=EN-US>setup_arch</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¨£©Î»ÓÚ</span><span lang=EN-US>arch/i386/kernel/setup.c</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÎÄ¼şÖĞ£¬ÎÒÃÇËù¹Ø×¢µÄÓëÎïÀíÄÚ´æÌ½²âÏà¹ØµÄÄÚÈİ¾ÍÔÚÕâ¸öº¯ÊıÖĞ¡£</span></p>

<p class=MsoNormal style='mso-outline-level:1'><span lang=EN-US>1</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£®</span><span lang=EN-US>setup_arch()</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>º¯Êı</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;
</span></span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>Õâ¸öº¯Êı±È½Ï·±ËöºÍÈß³¤£¬ÏÂÃæÎÒÃÇÖ»¶Ô</span><span
lang=EN-US>setup_arch</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£¨£©ÖĞÓëÄÚ´æÏà¹ØµÄÄÚÈİ¸øÓèÃèÊö¡£</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l10 level1 lfo1;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Ê×ÏÈµ÷ÓÃ</span><span
lang=EN-US>setup_memory_region()</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>º¯Êı£¬Õâ¸öº¯Êı´¦ÀíÄÚ´æ¹¹³ÉÍ¼£¨</span><span
lang=EN-US>map</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>£©</span><span lang=EN-US>,</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>²¢°ÑÄÚ´æµÄ·Ö²¼ĞÅÏ¢´æ·ÅÔÚÈ«¾Ö±äÁ¿</span><span lang=EN-US>e820</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÖĞ£¬ºóÃæ»á¶Ô´Ëº¯Êı½øĞĞ¾ßÌåÃèÊö¡£</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l10 level1 lfo1;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>µ÷ÓÃ</span><span
lang=EN-US>parse_mem_cmdline(cmdline_p)</span><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>º¯Êı¡£ÔÚÌØÊâµÄÇé¿öÏÂ£¬ÓĞµÄÏµÍ³¿ÉÄÜÓĞÌØÊâµÄ</span><span
lang=EN-US>RAM</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>¿Õ¼ä½á¹¹£¬´ËÊ±¿ÉÒÔÍ¨¹ıÒıµ¼ÃüÁîĞĞÖĞµÄÑ¡ÔñÏîÀ´¸Ä±ä´æ´¢¿Õ¼äµÄÂß¼­½á¹¹£¬Ê¹ÆäÕıÈ··´Ó³ÄÚ´æµÄÎïÀí½á¹¹¡£´Ëº¯ÊıµÄ×÷ÓÃ¾ÍÊÇ·ÖÎöÃüÁîĞĞÖĞµÄÑ¡ÔñÏî£¬²¢¾İ´Ë¶ÔÊı¾İ½á¹¹</span><span
lang=EN-US>e820</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>ÖĞµÄÄÚÈİ<span class=GramE>×÷³ö</span>ĞŞÕı£¬Æä´úÂëÒ²ÔÚ</span><span
lang=EN-US>setup.c</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ÖĞ¡£</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l15 level1 lfo2;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ºê¶¨Òå£º</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#define
PFN_UP(x)<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>(((x) + PAGE_SIZE-1) &gt;&gt; PAGE_SHIFT)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#define
PFN_DOWN(x)<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span>((x)
&gt;&gt; PAGE_SHIFT)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#define
PFN_PHYS(x)<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span>((x)
&lt;&lt; PAGE_SHIFT)</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:21.0pt'><span lang=EN-US>PFN_UP</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¨£©</span> <span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ºÍ</span><span
lang=EN-US>PFN_DOWN</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£¨£©¶¼ÊÇ½«µØÖ·</span><span
lang=EN-US>x</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>×ª»»ÎªÒ³ÃæºÅ£¨</span><span lang=EN-US>PFN</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>¼´</span><span lang=EN-US>Page Frame Number</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>µÄËõĞ´£©£¬¶şÕßÖ®¼äµÄÇø±ğÎª£º</span><span lang=EN-US>PFN_UP</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¨£©·µ»Ø´óÓÚ</span><span lang=EN-US>x</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>µÄµÚÒ»¸öÒ³ÃæºÅ£¬¶ø</span><span lang=EN-US>PFN_DOWN</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¨£©·µ»ØĞ¡ÓÚ</span><span lang=EN-US>x</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>µÄµÚÒ»¸öÒ³ÃæºÅ¡£ºê</span><span lang=EN-US>PFN_PHYS</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¨£©·µ»ØÒ³ÃæºÅ</span><span lang=EN-US>x</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>µÄÎïÀíµØÖ·¡£</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l14 level1 lfo3;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ºê¶¨Òå</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* 128MB for
vmalloc and initrd</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#define
VMALLOC_RESERVE (unsigned long<span class=GramE>)(</span>128 &lt;&lt; 20)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#define
MAXMEM (unsigned long<span class=GramE>)(</span>-PAGE_OFFSET-VMALLOC_RESERVE)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#define
MAXMEM_PFN PFN_<span class=GramE>DOWN(</span>MAXMEM)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#define
MAX_NONPAE_PFN (1 &lt;&lt; 20)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;
</span><span style='mso-tab-count:1'>&nbsp; </span></span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>¶ÔÕâ¼¸¸öºêÃèÊöÈçÏÂ£º</span></p>

<p class=MsoNormal style='text-indent:21.25pt'><span lang=EN-US>VMALLOC_RESERVE
</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>£ºÎª</span><span lang=EN-US>vmalloc</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¨£©º¯Êı·ÃÎÊÄÚºË¿Õ¼äËù±£ÁôµÄÄÚ´æÇø£¬´óĞ¡Îª</span><span lang=EN-US>128MB</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>¡£</span></p>

<p class=MsoNormal style='margin-left:21.25pt'><span lang=EN-US>MAXMEM </span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£ºÄÚºËÄÜ¹»Ö±½ÓÓ³ÉäµÄ×î´ó</span><span lang=EN-US>RAM</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÈİÁ¿£¬Îª</span><span lang=EN-US>1GB</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£­</span><span lang=EN-US>128MB</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£½</span><span
lang=EN-US>896MB</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>£¨</span><span lang=EN-US>-PAGE_OFFSET</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>¾ÍµÈÓÚ</span><span lang=EN-US>1GB</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£©</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>MAXMEM_PFN </span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£º·µ»ØÓÉÄÚºËÄÜÖ±½ÓÓ³ÉäµÄ×î´óÎïÀíÒ³ÃæÊı¡£</span></p>

<p class=MsoNormal style='margin-left:21.0pt'><span lang=EN-US>MAX_NONPAE_PFN </span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£º¸ø³öÔÚ</span><span lang=EN-US>4GB</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>Ö®ÉÏµÚÒ»¸öÒ³ÃæµÄÒ³ÃæºÅ¡£µ±Ò³ÃæÀ©³ä£¨</span><span lang=EN-US>PAE</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£©¹¦ÄÜÆôÓÃÊ±£¬²ÅÄÜ·ÃÎÊ</span><span lang=EN-US>4GB</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÒÔÉÏµÄÄÚ´æ¡£</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l5 level1 lfo4;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>»ñµÃÄÚºËÓ³ÏñÖ®ºóµÄÆğÊ¼Ò³ÃæºÅ</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* <span
class=GramE>partially</span> used pages are not usable - thus</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* <span
class=GramE>we</span> are rounding upwards:</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>start_pfn =
PFN_<span class=GramE>UP(</span>__pa(&amp;_end));</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:21.25pt'><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÔÚÉÏÒ»½ÚÒÑËµÃ÷£¬ºê</span><span lang=EN-US>__pa</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¨£©·µ»Ø¸ø¶¨ĞéÄâµØÖ·µÄÎïÀíµØÖ·¡£ÆäÖĞ±êÊ¶·û</span><span lang=EN-US>_end</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>±íÊ¾ÄÚºËÓ³ÏñÔÚÄÚºË¿Õ¼äµÄ½áÊøÎ»ÖÃ¡£Òò´Ë£¬´æ·ÅÔÚ±äÁ¿</span><span lang=EN-US>start_pfn</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÖĞµÄÖµ¾ÍÊÇ½ô½Ó×ÅÄÚºËÓ³ÏñÖ®ºóµÄÒ³ÃæºÅ¡£</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l7 level1 lfo5;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ÕÒ³ö¿ÉÓÃµÄ×î¸ßÒ³ÃæºÅ</span><span
lang=EN-US> </span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* Find the
highest page frame number we have available</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>max_pfn =
0;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>for</span> (i = 0; i &lt; e820.nr_map; i++) {</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>unsigned</span> long start, end;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*
RAM? */</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (e820.map[i].type != E820_RAM)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>continue</span>;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>start</span> = PFN_UP(e820.map[i].addr);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>end</span> = PFN_DOWN(e820.map[i].addr + e820.map[i].size);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (start &gt;= end)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>continue</span>;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (end &gt; max_pfn)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>max_pfn
= end;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>

<p class=MsoNormal style='margin-left:21.25pt'><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ÉÏÃæÕâ¶Î´úÂëÑ­»·²éÕÒÀàĞÍÎª</span><span
lang=EN-US>E820_RAM</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£¨¿ÉÓÃ</span><span
lang=EN-US>RAM</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>£©µÄÄÚ´æÇø£¬²¢°Ñ×îºóÒ»¸öÒ³ÃæµÄÒ³ÃæºÅ´æ·ÅÔÚ</span><span
lang=EN-US>max_pfn</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ÖĞ¡£</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l0 level1 lfo6;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>È·¶¨×î¸ßºÍ×îµÍÄÚ´æ·¶Î§</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* Determine
low and high memory ranges:</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>max_low_pfn
= max_pfn;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (max_low_pfn &gt; MAXMEM_PFN) {</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:1'>&nbsp; </span>max_low_pfn
= MAXMEM_PFN;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#ifndef
CONFIG_HIGHMEM</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/* Maximum
memory usable is what is directly addressable */</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:1'>&nbsp; </span><span
class=GramE>printk(</span>KERN_WARNING &quot;Warning only %ldMB will be
used.\n&quot;,</span></p>

<p class=MsoNormal style='mso-outline-level:1'><span lang=EN-US><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>MAXMEM&gt;&gt;20);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (max_pfn &gt; MAX_NONPAE_PFN)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>printk(</span>KERN_WARNING &quot;Use a PAE enabled
kernel.\n&quot;);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>else</span></span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>printk(</span>KERN_WARNING &quot;Use a HIGHMEM enabled
kernel.\n&quot;);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#else /<span
class=GramE>* !CONFIG</span>_HIGHMEM */</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#ifndef
CONFIG_X86_PAE</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (max_pfn &gt; MAX_NONPAE_PFN) {</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>max_pfn
= MAX_NONPAE_PFN;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>printk(</span>KERN_WARNING &quot;Warning only 4GB will be
used.\n&quot;);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;</span><span class=GramE>printk(</span>KERN_WARNING
&quot;Use a PAE enabled kernel.\n&quot;);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp; </span><span style='mso-tab-count:1'>&nbsp;&nbsp; </span>}</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#endif /<span
class=GramE>* !CONFIG</span>_X86_PAE */</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#endif /<span
class=GramE>* !CONFIG</span>_HIGHMEM */</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-indent:21.25pt'><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ÓĞÁ½ÖÖÇé¿ö£º</span></p>

<p class=MsoNormal style='margin-left:47.4pt;text-indent:-26.4pt;mso-list:l2 level1 lfo7;
tab-stops:list 47.4pt'><![if !supportLists]><span lang=EN-US style='mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>£¨1£©<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Èç¹ûÎïÀíÄÚ´æ</span><span
lang=EN-US>RAM</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>´óÓÚ</span><span lang=EN-US>896MB</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¬¶øĞ¡ÓÚ</span><span lang=EN-US>4GB</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¬ÔòÑ¡ÓÃ</span><span lang=EN-US>CONFIG_HIGHMEM</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>Ñ¡ÏîÀ´½øĞĞ·ÃÎÊ¡£</span></p>

<p class=MsoNormal style='margin-left:47.4pt;text-indent:-26.4pt;mso-list:l2 level1 lfo7;
tab-stops:list 47.4pt'><![if !supportLists]><span lang=EN-US style='mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>£¨2£©<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Èç¹ûÎïÀíÄÚ´æ</span><span
lang=EN-US>RAM</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>´óÓÚ</span><span lang=EN-US>4GB</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¬ÔòÑ¡ÓÃ</span><span lang=EN-US>CONFIG_X86_PAE</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¨ÆôÓÃ</span><span lang=EN-US>PAE</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Ä£Ê½£©À´½øĞĞ·ÃÎÊ¡£</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;
</span><span style='mso-spacerun:yes'>&nbsp;&nbsp;</span></span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÉÏÃæÕâ¶Î´úÂë¼ì²éÁËÕâÁ½ÖÖÇé¿ö£¬²¢ÏÔÊ¾ÊÊµ±µÄ¾¯¸æĞÅÏ¢¡£</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#ifdef
CONFIG_HIGHMEM</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>highstart_pfn
= highend_pfn = max_pfn;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (max_pfn &gt; MAXMEM_PFN) {</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>highstart_pfn
= MAXMEM_PFN;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>printk(</span>KERN_NOTICE &quot;%ldMB HIGHMEM available.\n&quot;,</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-tab-count:1'>&nbsp;&nbsp; </span>pages_to_<span
class=GramE>mb(</span>highend_pfn - highstart_pfn));</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#endif</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-indent:21.25pt'><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Èç¹ûÊ¹ÓÃÁË</span><span
lang=EN-US>CONFIG_HIGHMEM </span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Ñ¡Ïî£¬ÉÏÃæÕâ¶Î´úÂë½ö½ö´òÓ¡³ö´óÓÚ</span><span
lang=EN-US>896MB</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>µÄ¿ÉÓÃÎïÀíÄÚ´æÊıÁ¿¡£</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l13 level1 lfo8;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>³õÊ¼»¯Òıµ¼Ê±µÄ·ÖÅäÆ÷</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*
Initialize the boot-time allocator (with low memory only):</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>bootmap_size
= init_<span class=GramE>bootmem(</span>start_pfn, max_low_pfn);</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:21.25pt'><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Í¨¹ıµ÷ÓÃ</span><span
lang=EN-US>init_bootmem</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£¨£©º¯Êı£¬ÎªÎïÀíÄÚ´æÒ³Ãæ¹ÜÀí»úÖÆµÄ½¨Á¢×ö³õ²½×¼±¸£¬ÎªÕû¸öÎïÀíÄÚ´æ½¨Á¢ÆğÒ»¸öÒ³ÃæÎ»Í¼¡£Õâ¸öÎ»Í¼½¨Á¢ÔÚ´Ó</span><span
lang=EN-US>start_pfn</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>¿ªÊ¼µÄµØ·½£¬Ò²¾ÍÊÇËµ£¬°ÑÄÚºËÓ³ÏñÖÕµã</span><span
lang=EN-US>_end</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>ÉÏ·½µÄÈô¸ÉÒ³ÃæÓÃ×÷ÎïÀíÒ³ÃæÎ»Í¼¡£ÔÚÇ°ÃæµÄ´úÂëÖĞÒÑ¾­¸ãÇå³şÁËÎïÀíÄÚ´æ¶¥µãËùÔÚµÄÒ³ÃæºÅÎª</span><span
lang=EN-US>max_low_pfn</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£¬ËùÒÔÎïÀíÄÚ´æµÄÒ³ÃæºÅÒ»¶¨ÔÚ</span><span
lang=EN-US>0</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>¡«</span><span lang=EN-US>max_low_pfn</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>Ö®¼ä¡£¿ÉÊÇ£¬ÔÚÕâ¸ö·¶Î§ÄÚ¿ÉÄÜÓĞ¿Õ¶´£¨</span><span lang=EN-US>hole</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£©£¬ÁíÒ»·½Ãæ£¬²¢²»ÊÇËùÓĞµÄÎïÀíÄÚ´æÒ³Ãæ¶¼¿ÉÒÔ¶¯Ì¬·ÖÅä¡£½¨Á¢Õâ¸öÎ»Í¼µÄÄ¿µÄ¾ÍÊÇÒª¸ãÇå³şÄÄÒ»Ğ©ÎïÀíÄÚ´æÒ³Ãæ¿ÉÒÔ¶¯Ì¬·ÖÅäµÄ¡£ºóÃæ»á¾ßÌåÃèÊö</span><span
lang=EN-US>bootmem</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>·ÖÅäÆ÷¡£</span></p>

<p class=MsoNormal style='margin-left:21.25pt'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l3 level1 lfo9;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ÓÃ</span><span
lang=EN-US>bootmem </span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>·ÖÅäÆ÷£¬µÇ¼ÇÈ«²¿µÍÇø£¨</span><span
lang=EN-US>0</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>¡«</span><span lang=EN-US>896MB</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£©µÄ¿ÉÓÃ</span><span lang=EN-US>RAM</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>Ò³Ãæ</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* Register
fully available low RAM pages with the </span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* <span
class=GramE>bootmem</span> allocator.</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>for</span> (i = 0; i &lt; e820.nr_map; i++) {</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>unsigned</span> long curr_pfn, last_pfn, size;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* Reserve
usable low memory</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp; </span><span style='mso-tab-count:1'>&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;</span><span class=GramE>if</span> (e820.map[i].type
!= E820_RAM)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp; </span><span class=GramE>continue</span>;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* We are
rounding up the start address of usable memory:</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>curr_pfn
= PFN_<span class=GramE>UP(</span>e820.map[i].addr);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (curr_pfn &gt;= max_low_pfn)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>continue</span>;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* ... and
at the end of the usable range downwards:</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>last_pfn =
PFN_<span class=GramE>DOWN(</span>e820.map[i].addr + e820.map[i].size);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (last_pfn &gt; max_low_pfn)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>last_pfn
= max_low_pfn;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* .. <span
class=GramE>finally</span>, did all the rounding and playing</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* <span
class=GramE>around</span> just make the area go away?</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (last_pfn &lt;= curr_pfn)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>continue</span>;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>size</span> = last_pfn - curr_pfn;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>free_<span
class=GramE>bootmem(</span>PFN_PHYS(curr_pfn), PFN_PHYS(size));</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;
</span></span></p>

<p class=MsoNormal style='margin-left:21.25pt'><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Õâ¸öÑ­»·×ĞÏ¸¼ì²éËùÓĞ¿ÉÒÔÊ¹ÓÃµÄ</span><span
lang=EN-US>RAM</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>£¬²¢µ÷ÓÃ</span><span lang=EN-US>free_bootmem()</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>º¯Êı°ÑÕâĞ©¿ÉÓÃ</span><span lang=EN-US>RAM</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>±ê¼ÇÎª¿ÉÓÃ¡£Õâ¸öº¯Êıµ÷ÓÃÒÔºó£¬Ö»ÓĞÀàĞÍÎª</span><span lang=EN-US>1</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¨¿ÉÓÃ</span><span lang=EN-US>RAM</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£©µÄÄÚ´æ±»±ê¼ÇÎª¿ÉÓÃµÄ£¬²Î¿´ºóÃæ¶ÔÕâ¸öº¯ÊıµÄ¾ßÌåÃèÊö¡£</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l17 level1 lfo10;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>±£ÁôÄÚ´æ</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* Reserve
the bootmem bitmap itself as well. We do this in two</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* <span
class=GramE>steps</span> (first step was init_bootmem()) because this catches</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* <span
class=GramE>the</span> (very unlikely) case of us accidentally initializing the</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* <span
class=GramE>bootmem</span> allocator with an invalid RAM area.</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>reserve_<span
class=GramE>bootmem(</span>HIGH_MEMORY, (PFN_PHYS(start_pfn) +</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:3'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>bootmap_size
+ PAGE_SIZE-1) - (HIGH_MEMORY));</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-indent:21.25pt'><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Õâ¸öº¯Êı°ÑÄÚºËºÍ</span><span
lang=EN-US>bootmem</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Î»Í¼ËùÕ¼µÄÄÚ´æ±ê¼ÇÎª¡°±£Áô¡±¡£</span><span
lang=EN-US> HIGH_MEMORY</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Îª</span><span
lang=EN-US>1MB</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>£¬¼´ÄÚºË¿ªÊ¼µÄµØ·½£¬ºóÃæ»¹Òª¶ÔÕâ¸öº¯Êı½øĞĞ¾ßÌåÃèÊö</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l4 level1 lfo11;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>·Ö<span class=GramE>Ò³»úÖÆ</span>µÄ³õÊ¼»¯</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>paging_<span
class=GramE>init(</span>);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>Õâ¸öº¯Êı³õÊ¼»¯·ÖÒ³ÄÚ´æ¹ÜÀíËùĞèÒªµÄÊı¾İ½á¹¹£¬²Î¼ûºóÃæµÄÏêÏ¸ÃèÊö¡£</span></p>

<p class=MsoNormal style='mso-outline-level:1'><span lang=EN-US>2</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£®</span><span lang=EN-US> setup_memory_region() </span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>º¯Êı</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Õâ¸öº¯ÊıÓÃÀ´´¦Àí</span><span
lang=EN-US>BIOS</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>µÄÄÚ´æ¹¹³ÉÍ¼ºÍ<span class=GramE>²¢</span>°ÑÕâ¸ö¹¹³ÉÍ¼¿½±´µ½È«¾Ö±äÁ¿</span><span
lang=EN-US>e820</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>ÖĞ¡£Èç¹û²Ù×÷Ê§°Ü£¬¾Í´´½¨Ò»¸öÎ±ÄÚ´æ¹¹³ÉÍ¼¡£Õâ¸öº¯ÊıµÄÖ÷Òª²Ù×÷Îª£º</span></p>

<p class=MsoNormal style='margin-left:42.25pt;text-indent:-21.25pt;mso-list:
l6 level1 lfo12;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>µ÷ÓÃ</span><span
lang=EN-US>sanitize_e820_map()</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>º¯Êı£¬ÒÔÉ¾³ıÄÚ´æ¹¹³ÉÍ¼ÖĞÈÎºÎÖØµşµÄ²¿·Ö£¬ÒòÎª</span><span
lang=EN-US>BIOS</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>Ëù±¨¸æµÄÄÚ´æ¹¹³ÉÍ¼¿ÉÄÜÓĞÖØµş¡£</span></p>

<p class=MsoNormal style='margin-left:42.25pt;text-indent:-21.25pt;mso-list:
l6 level1 lfo12;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>µ÷ÓÃ</span><span
lang=EN-US>copy_e820_map()</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>½øĞĞÊµ¼ÊµÄ¿½±´¡£</span></p>

<p class=MsoNormal style='margin-left:42.25pt;text-indent:-21.25pt;mso-list:
l6 level1 lfo12;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Èç¹û²Ù×÷Ê§°Ü£¬´´½¨Ò»¸öÎ±ÄÚ´æ¹¹³ÉÍ¼£¬Õâ¸ö<span
class=GramE>Î±¹¹³É</span>Í¼ÓĞÁ½²¿·Ö£º</span><span lang=EN-US>0</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>µ½</span><span lang=EN-US>640K</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>¼°</span><st1:chmetcnv
UnitName="m" SourceValue="1" HasSpace="False" Negative="False" NumberType="1"
TCSC="0" w:st="on"><span lang=EN-US>1M</span></st1:chmetcnv><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>µ½×î´óÎïÀíÄÚ´æ¡£</span></p>

<p class=MsoNormal style='margin-left:42.25pt;text-indent:-21.25pt;mso-list:
l6 level1 lfo12;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>´òÓ¡×îÖÕµÄÄÚ´æ¹¹³ÉÍ¼</span></p>

<p class=MsoNormal style='mso-outline-level:1'><span lang=EN-US>3</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£®</span><span lang=EN-US>copy_e820_map() </span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>º¯Êı</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;
</span></span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>º¯ÊıÔ­ĞÍÎª£º</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span class=GramE>static</span>
int __init sanitize_e820_map(struct e820entry * biosmap, char * pnr_map)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;
</span></span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>ÆäÖ÷Òª²Ù×÷Îª£º</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l12 level1 lfo13;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Èç¹ûÎïÀíÄÚ´æÇø¼äĞ¡ÓÚ</span><span
lang=EN-US>2</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>£¬ÄÇ¿Ï¶¨³ö´í¡£ÒòÎª</span><span lang=EN-US>BIOS</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÖÁÉÙºÍ</span><span lang=EN-US>RAM</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ÊôÓÚ²»Í¬µÄÎïÀíÇø¼ä¡£</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span class=GramE><span
lang=EN-US>if</span></span><span lang=EN-US> (nr_map &lt; 2)</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span class=GramE>return</span>
-1;</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l18 level1 lfo14;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>´Ó</span><span
lang=EN-US>BIOS</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>¹¹³ÉÍ¼ÖĞ¶Á³öÒ»Ïî</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>do</span> {</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span class=GramE>unsigned</span>
long long start = biosmap-&gt;addr;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span class=GramE>unsigned</span>
long long size = biosmap-&gt;size;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span class=GramE>unsigned</span>
long long end = start + size;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span class=GramE>unsigned</span>
long type = biosmap-&gt;type;</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l11 level1 lfo15;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>½øĞĞ¼ì²é</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>/*
Overflow in 64 bits? Ignore the memory map. */</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span class=GramE>if</span>
(start &gt; end)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>return</span> -1;</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l1 level1 lfo16;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Ò»Ğ©</span><span
lang=EN-US>BIOS</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>°Ñ</span><span lang=EN-US>640K</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>¡«</span><span lang=EN-US>1MB</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Ö®¼äµÄÇø¼ä×÷Îª</span><span
lang=EN-US>RAM</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>À´ÓÃ£¬ÕâÊÇ²»·ûºÏ³£¹æµÄ¡£ÒòÎª´Ó</span><span
lang=EN-US>0xA0000</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>¿ªÊ¼µÄ¿Õ¼äÓÃÓÚÍ¼ĞÎ¿¨£¬Òò´Ë£¬ÔÚÄÚ´æ¹¹³ÉÍ¼ÖĞÒª½øĞĞĞŞÕı¡£Èç¹ûÒ»¸öÇøµÄÆğµãÔÚ</span><span
lang=EN-US>0xA0000</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ÒÔÏÂ£¬¶øÖÕµãÔÚ</span><span
lang=EN-US>1MB</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>Ö®ÉÏ£¬¾ÍÒª½«Õâ¸öÇø¼ä²ğ¿ª³ÉÁ½¸öÇø¼ä£¬ÖĞ¼äÌø¹ı´Ó</span><span
lang=EN-US>0xA0000</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>µ½</span><span
lang=EN-US>1MB</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>±ß½çÖ®¼äµÄÄÇÒ»²¿·Ö¡£</span></p>

<p class=MsoNormal><span lang=EN-US>/*</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* Some
BIOSes claim RAM in the 640k - <st1:chmetcnv UnitName="m" SourceValue="1"
HasSpace="False" Negative="False" NumberType="1" TCSC="0" w:st="on">1M</st1:chmetcnv>
region.</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>* Not
right. Fix it up.</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>*/</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span style='mso-tab-count:
2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (type == E820_RAM) {</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (start &lt; 0x100000ULL &amp;&amp; end &gt; 0xA0000ULL) {</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (start &lt; 0xA0000ULL)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>add_memory_<span
class=GramE>region(</span>start, 0xA0000ULL-start, type)<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;</span><span class=GramE>if</span> (end &lt;=
0x100000ULL)</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>continue</span>;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>start</span> = 0x100000ULL;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-tab-count:2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;</span><span class=GramE>size</span> = end -
start;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'> </span><span style='mso-spacerun:yes'>&nbsp;</span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span style='mso-tab-count:
2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span style='mso-tab-count:
2'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>add_memory_<span
class=GramE>region(</span>start, size, type);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>} while
(biosmap++,--nr_map);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>return</span> 0;</span></p>

<p class=MsoNormal><span lang=EN-US>4</span><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£®</span><span
lang=EN-US> add_memory_region() </span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>º¯Êı</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;
</span></span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>Õâ¸öº¯ÊıµÄ¹¦ÄÜ¾ÍÊÇÔÚ</span><span lang=EN-US>e820</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÖĞÔö¼ÓÒ»Ïî£¬ÆäÖ÷Òª²Ù×÷Îª£º</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l9 level1 lfo17;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>»ñµÃÒÑ×·¼ÓÔÚ</span><span
lang=EN-US>e820</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>ÖĞµÄÄÚ´æÇøÊı</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=PT-BR style='mso-ansi-language:PT-BR'>int x = e820.nr_map;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l8 level1 lfo18;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Èç¹ûÊıÄ¿ÒÑ´ïµ½×î´ó£¨</span><span
lang=EN-US>32</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>£©£¬ÔòÏÔÊ¾Ò»¸ö¾¯¸æĞÅÏ¢²¢·µ»Ø</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>if</span> (x == E820MAX) {</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span class=GramE>printk(</span>KERN_ERR
&quot;Oops! Too many entries in </span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>the memory map<span class=GramE>!\</span>n&quot;);</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span class=GramE>return</span>;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>

<p class=MsoNormal style='margin-left:21.25pt;text-indent:-21.25pt;mso-list:
l16 level1 lfo19;tab-stops:list 21.25pt'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ÔÚ</span><span
lang=EN-US>e820</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>ÖĞÔö¼ÓÒ»Ïî£¬²¢¸ø</span><span lang=EN-US>nr_map</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>¼Ó</span><span lang=EN-US>1</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>e820.map[x].addr
= start;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>e820.map[x].size
= size;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>e820.map[x].type
= type;</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>e820.nr_map</span>++;</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-outline-level:1'><span lang=EN-US>5</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£®</span><span lang=EN-US> print_memory_map() </span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>º¯Êı</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>Õâ¸öº¯Êı°ÑÄÚ´æ¹¹³ÉÍ¼ÔÚ¿ØÖÆÌ¨ÉÏÊä³ö£¬º¯Êı±¾Éí±È½Ï¼òµ¥£¬ÔÚ´Ë¸ø³öÒ»¸öÔËĞĞÊµÀı¡£ÀıÈçº¯ÊıµÄÊä³öÎª£¨</span><span
lang=EN-US>BIOS</span><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>ËùÌá¹©µÄÎïÀí</span><span lang=EN-US>RAM</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>Çø¼ä£©£º</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=PT-BR style='mso-ansi-language:PT-BR'>BIOS-e820: 0000000000000000 - <st1:chmetcnv
UnitName="a" SourceValue="0" HasSpace="False" Negative="False" NumberType="1"
TCSC="0" w:st="on">00000000000a</st1:chmetcnv>0000 (usable)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>BIOS-e820: <st1:chmetcnv
UnitName="F" SourceValue="0" HasSpace="False" Negative="False" NumberType="1"
TCSC="0" w:st="on">00000000000f</st1:chmetcnv>0000 - 0000000000100000
(reserved)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>BIOS-e820:
0000000000100000 - <st1:chmetcnv UnitName="C" SourceValue="0" HasSpace="False"
Negative="False" NumberType="1" TCSC="0" w:st="on">000000000c</st1:chmetcnv>000000
(usable)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=PT-BR style='mso-ansi-language:PT-BR'><span
style='mso-tab-count:1'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>BIOS-e820:
00000000ffff0000 - 0000000100000000 (reserved)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=PT-BR style='mso-ansi-language:PT-BR'><o:p>&nbsp;</o:p></span></p>

</div>

</body>


<!-- Mirrored from www.kerneltravel.net/kernel-book/ç¬¬å…­ç« %20Linuxå†…å­˜ç®¡ç†/6.2.2.htm by HTTrack Website Copier/3.x [XR&CO'2008], Sat, 29 Dec 2012 03:00:36 GMT -->
</html>
