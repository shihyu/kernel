<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">


<!-- Mirrored from www.kerneltravel.net/kernel-book/ç¬¬å…«ç« %20è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ/8.3.2.htm by HTTrack Website Copier/3.x [XR&CO'2008], Sat, 29 Dec 2012 03:01:13 GMT -->
<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="8.3.2.files/filelist.html">
<title>Ë÷Òı½Úµã¸ßËÙ»º´æ</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="chsdate" downloadurl=""/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>CLJ</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>CLJ</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>0</o:TotalTime>
  <o:Created>2007-08-15T09:09:00Z</o:Created>
  <o:LastSaved>2007-08-15T09:09:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>787</o:Words>
  <o:Characters>4486</o:Characters>
  <o:Lines>37</o:Lines>
  <o:Paragraphs>10</o:Paragraphs>
  <o:CharactersWithSpaces>5263</o:CharactersWithSpaces>
  <o:Version>11.5606</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:GrammarState>Clean</w:GrammarState>
  <w:PunctuationKerning/>
  <w:DrawingGridVerticalSpacing>7.8 °õ</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:AdjustLineHeightInTable/>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:ËÎÌå;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:SimSun;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
@font-face
	{font-family:"\@ËÎÌå";
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	mso-pagination:none;
	font-size:10.5pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:ËÎÌå;
	mso-font-kerning:1.0pt;}
p.MsoPlainText, li.MsoPlainText, div.MsoPlainText
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	mso-pagination:none;
	font-size:10.5pt;
	mso-bidi-font-size:10.0pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";
	mso-font-kerning:1.0pt;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
 /* Page Definitions */
 @page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:42.55pt;
	mso-footer-margin:49.6pt;
	mso-paper-source:0;
	layout-grid:15.6pt;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:102649963;
	mso-list-type:simple;
	mso-list-template-ids:-1026548344;}
@list l0:level1
	{mso-level-text:£¨%1£©;
	mso-level-tab-stop:40.8pt;
	mso-level-number-position:left;
	margin-left:40.8pt;
	text-indent:-36.0pt;}
@list l1
	{mso-list-id:152531100;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l2
	{mso-list-id:211699040;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l2:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l3
	{mso-list-id:565340561;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l3:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l4
	{mso-list-id:1937590313;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l4:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
@list l5
	{mso-list-id:2018656272;
	mso-list-type:simple;
	mso-list-template-ids:1937021516;}
@list l5:level1
	{mso-level-number-format:bullet;
	mso-level-text:¡¤;
	mso-level-tab-stop:21.25pt;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;
	font-family:ËÎÌå;
	mso-hansi-font-family:Wingdings;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:ÆÕÍ¨±í¸ñ;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=ZH-CN style='tab-interval:21.0pt;text-justify-trim:punctuation'>

<div class=Section1 style='layout-grid:15.6pt'>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><st1:chsdate Year="1899" Month="12" Day="30"
IsLunarDate="False" IsROCDate="False" w:st="on"><b style='mso-bidi-font-weight:
 normal'><span lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";
 color:black;mso-font-kerning:0pt'>8.3.2</span></b></st1:chsdate><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:ËÎÌå;
mso-hansi-font-family:"Times New Roman";color:black;mso-font-kerning:0pt'><span
style='mso-spacerun:yes'>&nbsp; </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:ËÎÌå;mso-hansi-font-family:"Times New Roman";
color:black;mso-font-kerning:0pt'>Ë÷Òı½Úµã¸ßËÙ»º´æ<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span lang=EN-US
style='mso-font-kerning:0pt'>VFS</span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";mso-font-kerning:
0pt'>Ò²ÓÃÁËÒ»¸ö¸ßËÙ»º´æÀ´¼Ó¿ì¶ÔË÷Òı½ÚµãµÄ·ÃÎÊ£¬ºÍ¿é¸ßËÙ»º´æ²»Í¬µÄÒ»µãÊÇÃ¿¸ö»º³åÇø²»ÓÃÔÙ·ÖÎªÁ½¸ö²¿·ÖÁË£¬ÒòÎª</span><span
lang=EN-US style='mso-font-kerning:0pt'>inode</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-font-kerning:0pt'>½á¹¹ÖĞÒÑ¾­ÓĞÁËÀàËÆÓÚ¿é¸ßËÙ»º´æÖĞ»º³åÇøÊ×²¿µÄÓò¡£Ë÷Òı½Úµã¸ßËÙ»º´æµÄÊµÏÖ´úÂë</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>È«²¿ÔÚ</span><span lang=EN-US>fs/inode.c</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¬Õâ²¿·Ö´úÂë²¢Ã»ÓĞËæ×ÅÄÚºË°æ±¾µÄ±ä»¯×öºÜ¶àµÄĞŞ¸Ä¡£</span></p>

<p class=MsoNormal align=left style='text-align:left;mso-layout-grid-align:
none;text-autospace:none'><span lang=EN-US>1</span><span style='font-family:
ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£®Ë÷Òı½ÚµãÁ´±í</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Ã¿¸öË÷Òı½Úµã¿ÉÄÜ´¦ÓÚ¹şÏ£±íÖĞ£¬Ò²¿ÉÄÜÍ¬Ê±´¦ÓÚÏÂÁĞ¡°ÀàĞÍ¡±Á´±íµÄÒ»ÖÖÖĞ£º</span></p>

<p class=MsoNormal align=left style='margin-left:21.25pt;text-align:left;
text-indent:-21.25pt;mso-list:l5 level1 lfo1;tab-stops:list 21.25pt;mso-layout-grid-align:
none;text-autospace:none'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>&quot;in_use&quot; ¨C </span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÓĞĞ§µÄË÷Òı½Úµã£¬¼´</span><span lang=EN-US> i_count &gt; 0</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÇÒ</span><span lang=EN-US>i_nlink &gt; 0</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>£¨²Î¿´Ç°ÃæµÄ</span><span lang=EN-US>inode</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>½á¹¹£©</span></p>

<p class=MsoNormal align=left style='margin-left:21.25pt;text-align:left;
text-indent:-21.25pt;mso-list:l1 level1 lfo2;tab-stops:list 21.25pt;mso-layout-grid-align:
none;text-autospace:none'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>&quot;dirty&quot;<span
style='mso-spacerun:yes'>&nbsp; </span>- </span><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>ÀàËÆÓÚ</span><span
lang=EN-US> &quot;in_use&quot; </span><span style='font-family:ËÎÌå;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>£¬µ«»¹¡°Ôà¡±</span></p>

<p class=MsoNormal align=left style='margin-left:21.25pt;text-align:left;
text-indent:-21.25pt;mso-list:l4 level1 lfo3;tab-stops:list 21.25pt;mso-layout-grid-align:
none;text-autospace:none'><![if !supportLists]><span lang=EN-US
style='font-family:ËÎÌå;mso-hansi-font-family:Wingdings;mso-bidi-font-family:
ËÎÌå'><span style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>&quot;unused&quot; ¨C </span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>ÓĞĞ§µÄË÷Òı½Úµãµ«»¹Ã»Ê¹ÓÃ£¬¼´</span><span lang=EN-US> i_count = 0</span><span
style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>¡£</span></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:24.0pt;
mso-layout-grid-align:none;text-autospace:none'><span style='font-family:ËÎÌå;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>Õâ¼¸¸öÁ´±í¶¨ÒåÈçÏÂ£º</span></p>

<p class=MsoPlainText style='text-indent:21.0pt'><span class=GramE><span
lang=EN-US>static</span></span><span lang=EN-US> LIST_HEAD(inode_in_use);</span></p>

<p class=MsoPlainText style='text-indent:21.0pt'><span class=GramE><span
lang=EN-US>static</span></span><span lang=EN-US> LIST_HEAD(inode_unused);</span></p>

<p class=MsoPlainText style='text-indent:21.0pt'><span class=GramE><span
lang=EN-US>static</span></span><span lang=EN-US> struct list_head
*inode_hashtable;</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span><span class=GramE><span
lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:"Courier New"'>static</span></span><span
lang=EN-US style='font-family:ËÎÌå;mso-hansi-font-family:"Courier New"'>
LIST_HEAD(anon_hash_chain); /* for inodes with NULL i_sb */<o:p></o:p></span></p>

<p class=MsoPlainText><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;
</span></span>Òò´Ë£¬Ë÷Òı½Úµã¸ßËÙ»º´æµÄ½á¹¹¸ÅÊöÈçÏÂ£º</p>

<p class=MsoPlainText style='margin-left:21.25pt;text-indent:-21.25pt;
mso-list:l2 level1 lfo4;tab-stops:list 21.25pt'><![if !supportLists]><span
lang=EN-US style='mso-hansi-font-family:Wingdings;mso-bidi-font-family:ËÎÌå'><span
style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>È«¾Ö¹şÏ£±í<span lang=EN-US>inode_hashtable</span>£¬ÆäÖĞ¹şÏ£ÖµÊÇ¸ù¾İÃ¿¸ö³¬¼¶¿éÖ¸ÕëµÄÖµºÍ<span
lang=EN-US>32</span>Î»Ë÷Òı½ÚµãºÅ¶øµÃ¡£¶ÔÃ»ÓĞ³¬¼¶¿éµÄË÷Òı½Úµã£¨<span lang=EN-US>inode-&gt;i_sb ==
NULL</span>£©£¬Ôò½«Æä¼ÓÈëµ½<span lang=EN-US>anon_hash_chain</span>Á´±íµÄÊ×²¿¡£ÀıÈç£¬<span
lang=EN-US>net/socket.c</span>ÖĞ<span lang=EN-US>sock_alloc()</span>º¯Êı<span
lang=EN-US>, </span>Í¨¹ıµ÷ÓÃ<span lang=EN-US>fs/inode.c</span>ÖĞ<span lang=EN-US>get_empty_inode()</span>´´½¨µÄÌ×½Ó×ÖÊÇÒ»¸öÄäÃûË÷Òı½Úµã£¬Õâ¸ö½Úµã¾Í¼ÓÈëµ½ÁË<span
lang=EN-US>anon_hash_chain</span>Á´±í¡£</p>

<p class=MsoPlainText style='margin-left:21.25pt;text-indent:-21.25pt;
mso-list:l2 level1 lfo4;tab-stops:list 21.25pt'><![if !supportLists]><span
lang=EN-US style='mso-hansi-font-family:Wingdings;mso-bidi-font-family:ËÎÌå'><span
style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>ÕıÔÚÊ¹ÓÃµÄË÷Òı½ÚµãÁ´±í¡£È«¾Ö±äÁ¿<span lang=EN-US>inode_in_use</span>Ö¸Ïò¸ÃÁ´±íÖĞµÄÊ×ÔªËØºÍ<span
class=GramE>Î²ÔªËØ</span>¡£º¯Êı<span lang=EN-US>get_empty_inode()</span>»ñµÃÒ»¸ö¿Õ½Úµã£¬<span
lang=EN-US>get_new_inode()</span>»ñµÃÒ»¸öĞÂ½Úµã£¬Í¨¹ıÕâÁ½¸öº¯ÊıĞÂ·ÖÅäµÄË÷Òı½Úµã¾Í¼ÓÈëµ½Õâ¸öÁ´±íÖĞ¡£</p>

<p class=MsoPlainText style='margin-left:21.25pt;text-indent:-21.25pt;
mso-list:l2 level1 lfo4;tab-stops:list 21.25pt'><![if !supportLists]><span
lang=EN-US style='mso-hansi-font-family:Wingdings;mso-bidi-font-family:ËÎÌå'><span
style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>Î´ÓÃË÷Òı½ÚµãÁ´±í¡£È«¾Ö±äÁ¿<span lang=EN-US>inode_unused</span>µÄ<span
lang=EN-US>next</span>Óò ºÍ<span lang=EN-US>prev</span><span class=GramE>Óò·Ö±ğ</span>Ö¸Ïò¸ÃÁ´±íÖĞµÄÊ×ÔªËØºÍ<span
class=GramE>Î²ÔªËØ</span>¡£</p>

<p class=MsoPlainText style='margin-left:21.25pt;text-indent:-21.25pt;
mso-list:l2 level1 lfo4;tab-stops:list 21.25pt'><![if !supportLists]><span
lang=EN-US style='mso-hansi-font-family:Wingdings;mso-bidi-font-family:ËÎÌå'><span
style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>ÔàË÷Òı½ÚµãÁ´±í¡£ÓÉÏàÓ¦³¬¼¶¿éµÄ<span lang=EN-US>s_dirty</span>ÓòÖ¸Ïò¸ÃÁ´±íÖĞµÄÊ×ÔªËØºÍ<span
class=GramE>Î²ÔªËØ</span>¡£</p>

<p class=MsoPlainText style='margin-left:21.25pt;text-indent:-21.25pt;
mso-list:l2 level1 lfo4;tab-stops:list 21.25pt'><![if !supportLists]><span
lang=EN-US style='mso-hansi-font-family:Wingdings;mso-bidi-font-family:ËÎÌå'><span
style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>¶Ô<span lang=EN-US>inode</span>¶ÔÏóµÄ»º´æ£¬¶¨ÒåÈçÏÂ£º</p>

<p class=MsoPlainText style='text-indent:20.4pt'><span class=GramE><span
lang=EN-US>static</span></span><span lang=EN-US> kmem_cache_t * inode_cachep</span></p>

<p class=MsoPlainText style='text-indent:20.4pt'>ÕâÊÇÒ»¸ö<span lang=EN-US>Slab</span>»º´æ£¬ÓÃÓÚ·ÖÅäºÍÊÍ·ÅË÷Òı½Úµã¶ÔÏó¡£</p>

<p class=MsoPlainText><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='text-indent:21.25pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp; </span></span>Ë÷Òı½ÚµãµÄ<span lang=EN-US>i_hash</span>ÓòÖ¸Ïò¹şÏ£±í£¬<span
lang=EN-US>i_list</span>Ö¸Ïò<span lang=EN-US>in_use</span>¡¢<span lang=EN-US>unused
</span>»ò<span lang=EN-US> dirty</span>Ä³¸öÁ´±í¡£ËùÓĞÕâĞ©Á´±í¶¼ÊÜµ¥¸ö×ÔĞıËø<span lang=EN-US>inode_lock</span>µÄ±£»¤£¬Æä¶¨ÒåÈçÏÂ£º</p>

<p class=MsoPlainText style='text-indent:21.25pt'><span lang=EN-US>/*</span></p>

<p class=MsoPlainText style='text-indent:21.25pt'><span lang=EN-US>* A simple
spinlock to protect the list manipulations.</span></p>

<p class=MsoPlainText style='text-indent:21.25pt'><span lang=EN-US>*</span></p>

<p class=MsoPlainText style='text-indent:21.25pt'><span lang=EN-US>* NOTE! You
also have to own the lock if you change</span></p>

<p class=MsoPlainText style='text-indent:21.25pt'><span lang=EN-US>* <span
class=GramE>the</span> i_state of an inode while it is in use..</span></p>

<p class=MsoPlainText style='text-indent:21.25pt'><span lang=EN-US>*/</span></p>

<p class=MsoPlainText style='text-indent:21.25pt'><span class=GramE><span
lang=EN-US>static</span></span><span lang=EN-US> spinlock_t inode_lock =
SPIN_LOCK_UNLOCKED;</span></p>

<p class=MsoPlainText style='text-indent:21.25pt'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span>Ë÷Òı½Úµã¸ßËÙ»º´æµÄ³õÊ¼»¯ÊÇÓÉ<span
lang=EN-US>inode_init()</span>ÊµÏÖµÄ£¬¶øÕâ¸öº¯ÊıÊÇÔÚÏµÍ³Æô¶¯Ê±ÓÉ<span lang=EN-US>init/main.c</span>ÖĞµÄ<span
lang=EN-US>start_kernel()</span>º¯Êıµ÷ÓÃµÄ¡£<span lang=EN-US>inode_init</span>£¨£©Ö»ÓĞÒ»¸ö²ÎÊı£¬±íÊ¾Ë÷Òı½Úµã¸ßËÙ»º´æËùÊ¹ÓÃµÄÎïÀíÒ³ÃæÊı¡£Òò´Ë£¬Ë÷Òı½Úµã¸ßËÙ»º´æ¿ÉÒÔ¸ù¾İ¿ÉÓÃÎïÀíÄÚ´æµÄ´óĞ¡À´½øĞĞÅäÖÃ£¬ÀıÈç£¬Èç¹ûÎïÀíÄÚ´æ×ã¹»´óµÄ»°£¬¾Í¿ÉÒÔ´´½¨Ò»¸ö´óµÄ¹şÏ£±í¡£</p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span>Ë÷Òı½Úµã×´Ì¬µÄĞÅÏ¢´æ·ÅÔÚÊı¾İ½á¹¹<span
lang=EN-US>inodes_stat_t</span>ÖĞ£¬ÔÚ<span lang=EN-US>fs/fs.h</span>ÖĞ¶¨ÒåÈçÏÂ£º</p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span class=GramE>struct</span>
inodes_stat_t {</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>int</span> nr_inodes;</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>int</span> nr_unused;</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>int</span> dummy[5];</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>};</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span class=GramE>extern</span>
struct inodes_stat_t inodes_stat</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span>ÓÃ»§³ÌĞò¿ÉÒÔÍ¨¹ı<span
lang=EN-US>/proc/sys/fs/inode-nr </span>ºÍ<span lang=EN-US>
/proc/sys/fs/inode-state</span>»ñµÃË÷Òı½Úµã¸ßËÙ»º´æÖĞË÷Òı½Úµã×ÜÊı¼°Î´ÓÃË÷Òı½ÚµãÊı¡£</p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>2</span>£®Ë÷Òı½Úµã¸ßËÙ»º´æµÄ¹¤×÷¹ı³Ì</p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span>ÎªÁË°ïÖú´ó¼ÒÀí½âË÷Òı½Úµã¸ßËÙ»º´æÈçºÎ¹¤×÷£¬ÎÒÃÇÀ´¸ú×ÙÒ»ÏÂÔÚ´ò¿ª<span
lang=EN-US>Ext2</span>ÎÄ¼şÏµÍ³µÄÒ»¸ö³£¹æÎÄ¼şÊ±£¬ÏàÓ¦Ë÷Òı½ÚµãµÄ×÷ÓÃ¡£</p>

<p class=MsoPlainText><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-left:36.0pt'><span class=GramE><span
lang=EN-US>fd</span></span><span lang=EN-US> = open(&quot;file&quot;,
O_RDONLY);</span></p>

<p class=MsoPlainText style='text-indent:36.0pt'><span class=GramE><span
lang=EN-US>close(</span></span><span lang=EN-US>fd);</span></p>

<p class=MsoPlainText style='text-indent:36.0pt'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>open()</span>ÏµÍ³µ÷ÓÃÊÇÓÉ<span
lang=EN-US>fs/open.c</span>ÖĞµÄ<span lang=EN-US>sys_open</span>º¯ÊıÊµÏÖµÄ£¬¶øÕæÕıµÄ¹¤×÷ÊÇÓÉ<span
lang=EN-US>fs/open.c</span>ÖĞµÄ<span lang=EN-US>filp_open()</span>º¯ÊıÍê³ÉµÄ£¬<span
lang=EN-US>filp_open()</span>º¯ÊıÈçÏÂ£º</p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span><span class=GramE>struct</span>
file *filp_open(const char * filename, int flags, int mode)</span></p>

<p class=MsoPlainText><span lang=EN-US>{</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>int</span> namei_flags, error;</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>struct</span> nameidata nd;</span></p>

<p class=MsoPlainText><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>namei_flags = flags;</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> ((namei_flags+1) &amp; O_ACCMODE)</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>namei_flags</span>++;</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (namei_flags &amp; O_TRUNC)</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>namei_flags |= 2;</span></p>

<p class=MsoPlainText><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>error</span> = open_namei(filename, namei_flags, mode, &amp;nd);</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (!error)</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> dentry_open(nd.dentry, nd.mnt, flags);</span></p>

<p class=MsoPlainText><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> ERR_PTR(error);</span></p>

<p class=MsoPlainText><span lang=EN-US>}</span></p>

<p class=MsoPlainText style='margin-left:4.8pt'>ÆäÖĞ<span lang=EN-US>nameidata</span>½á¹¹ÔÚ<span
lang=EN-US>fs.h</span>ÖĞ¶¨ÒåÈçÏÂ£º</p>

<p class=MsoPlainText style='margin-left:4.8pt'><span class=GramE><span
lang=EN-US>struct</span></span><span lang=EN-US> nameidata {</span></p>

<p class=MsoPlainText style='margin-left:4.8pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>struct</span> dentry *dentry;</span></p>

<p class=MsoPlainText style='margin-left:4.8pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>struct</span> vfsmount *mnt;</span></p>

<p class=MsoPlainText style='margin-left:4.8pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>struct</span> qstr last;</span></p>

<p class=MsoPlainText style='margin-left:4.8pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>unsigned</span> int flags;</span></p>

<p class=MsoPlainText style='margin-left:4.8pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>int</span> last_type;</span></p>

<p class=MsoPlainText><span lang=EN-US>};</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span>Õâ¸öÊı¾İ½á¹¹ÊÇÁÙÊ±ĞÔµÄ£¬ÆäÖĞ£¬ÎÒÃÇÖ÷Òª¹Ø×¢<span
lang=EN-US>dentry</span>ºÍ<span lang=EN-US>mnt</span>Óò¡£<span lang=EN-US>Dentry</span>½á¹¹ÎÒÃÇÒÑ¾­ÔÚÇ°Ãæ½éÉÜ¹ı£¬¶ø<span
lang=EN-US>vfsmount</span>½á¹¹¼ÇÂ¼×ÅËùÊôÎÄ¼şÏµÍ³µÄ°²×°ĞÅÏ¢£¬ÀıÈçÎÄ¼şÏµÍ³µÄ°²×°µã¡¢ÎÄ¼şÏµÍ³µÄ¸ù½ÚµãµÈ¡£</p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>filp_open</span>£¨£©Ö÷Òªµ÷ÓÃÒÔÏÂÁ½¸öº¯Êı</p>

<p class=MsoPlainText style='margin-left:40.8pt;text-indent:-36.0pt;mso-list:
l0 level1 lfo5;tab-stops:list 40.8pt'><![if !supportLists]><span lang=EN-US
style='mso-bidi-font-family:ËÎÌå'><span style='mso-list:Ignore'>£¨1£©<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US>open_namei()</span>£ºÌî³äÄ¿±êÎÄ¼şËùÔÚÄ¿Â¼µÄ<span lang=EN-US>dentry</span>½á¹¹ ºÍ ËùÔÚÎÄ¼şÏµÍ³µÄ<span
lang=EN-US>vfsmount</span>½á¹¹¡£ÔÚ<span lang=EN-US>dentry</span>½á¹¹ÖĞ<span
lang=EN-US>dentry-&gt;d_inode</span>¾ÍÖ¸ÏòÄ¿±êÎÄ¼şµÄË÷Òı½Úµã¡£Õâ¸öº¯Êı±È½Ï¸´ÔÓºÍÅÓ´ó£¬ÔÚ´ËÎªÁËÍ»³öÖ÷Ìâ£¬ºóÃæÎÒÃÇÖ»½éÉÜÓëÖ÷ÌâÏà¹ØµÄÄÚÈİ¡£</p>

<p class=MsoPlainText style='margin-left:40.8pt;text-indent:-36.0pt;mso-list:
l0 level1 lfo5;tab-stops:list 40.8pt'><![if !supportLists]><span lang=EN-US
style='mso-bidi-font-family:ËÎÌå'><span style='mso-list:Ignore'>£¨2£©<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US>dentry_open()</span>£º½¨Á¢Ä¿±êÎÄ¼şµÄÒ»¸ö¡°ÉÏÏÂÎÄ¡±£¬¼´<span lang=EN-US>file</span>Êı¾İ½á¹¹£¬²¢ÈÃËüÓëµ±Ç°½ø³ÌµÄ<span
lang=EN-US>task_strrct</span>½á¹¹¹ÒÉÏ¹³¡£Í¬Ê±£¬ÔÚÕâ¸öº¯ÊıÖĞ£¬µ÷ÓÃÁË¾ßÌåÎÄ¼şÏµÍ³µÄ´ò¿ªº¯Êı£¬¼´<span lang=EN-US>f_op-&gt;open()</span>¡£¸Ãº¯Êı·µ»ØÖ¸ÏòĞÂ½¨Á¢µÄ<span
lang=EN-US>file</span>½á¹¹µÄÖ¸Õë¡£</p>

<p class=MsoPlainText style='margin-left:4.8pt'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText style='margin-left:4.8pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span>open_namei()</span>º¯ÊıÍ¨¹ı<span
lang=EN-US>path_walk()</span>ÓëÄ¿Â¼Ïî¸ßËÙ»º´æ£¨¼´Ä¿Â¼Ïî¹şÏ£±í£©´ò½»µÀ£¬¶ø<span lang=EN-US>path_walk()</span>ÓÖµ÷ÓÃ¾ßÌåÎÄ¼şÏµÍ³µÄ<span
lang=EN-US>inode_operations-&gt;lookup()</span>·½·¨£»¸Ã·½·¨´Ó´ÅÅÌÕÒµ½²¢¶ÁÈëµ±Ç°½ÚµãµÄÄ¿Â¼Ïî£¬È»ºóÍ¨¹ı<span
lang=EN-US>iget(sb, ino),</span>¸ù¾İË÷Òı½ÚµãºÅ´Ó´ÅÅÌ¶ÁÈëÏàÓ¦Ë÷Òı½Úµã²¢ÔÚÄÚ´æ½¨Á¢ÆğÏàÓ¦µÄ<span lang=EN-US>inode</span>½á¹¹£¬Õâ¾Íµ½ÁËÎÒÃÇÌÖÂÛµÄË÷Òı½Úµã¸ßËÙ»º´æ¡£</p>

<p class=MsoPlainText style='margin-left:4.8pt;text-indent:31.2pt'>µ±Ë÷Òı½Úµã¶ÁÈëÄÚ´æºó£¬Í¨¹ıµ÷ÓÃ<span
lang=EN-US>d_add(dentry, inode)</span>£¬¾Í½«<span lang=EN-US>dentry</span>½á¹¹ºÍ<span
lang=EN-US>inode</span>½á¹¹Ö®¼äµÄÁ´½Ó¹ØÏµ½¨Á¢ÆğÀ´¡£Á½¸öÊı¾İ½á¹¹Ö®¼äµÄÁªÏµÊÇË«ÏòµÄ¡£Ò»·½Ãæ£¬<span lang=EN-US>dentry</span>½á¹¹ÖĞµÄÖ¸Õë<span
lang=EN-US>d_inode</span>Ö¸Ïò<span lang=EN-US>inode</span>½á¹¹£¬ÕâÊÇÒ»¶ÔÒ»µÄ¹ØÏµ£¬ÒòÎªÒ»¸öÄ¿Â¼ÏîÖ»¶ÔÓ¦×ÅÒ»¸öÎÄ¼ş¡£·´Ö®Ôò²»È»£¬Í¬Ò»¸öÎÄ¼ş¿ÉÒÔÓĞ¶à¸ö²»Í¬µÄÎÄ¼şÃû»òÂ·¾¶£¨Í¨¹ıÏµÍ³µ÷ÓÃ<span
lang=EN-US>link()</span>½¨Á¢£¬×¢ÒâÓë·ûºÅÁ¬½ÓµÄÇø±ğ£¬ÄÇÊÇÓÉ<span lang=EN-US>symlink</span>£¨£©½¨Á¢µÄ£©£¬ËùÒÔ´Ó<span
lang=EN-US>inode</span>½á¹¹µ½<span lang=EN-US>dentry</span>½á¹¹µÄ·½ÏòÊÇÒ»¶Ô¶àµÄ¹ØÏµ¡£Òò´Ë£¬<span
lang=EN-US> inode</span>½á¹¹µÄ<span lang=EN-US>i_ dentry</span>ÊÇ¸ö¶ÓÁĞ£¬<span
lang=EN-US>dentry</span>½á¹¹Í¨¹ıÆä¶ÓÁĞÍ·²¿<span lang=EN-US>d_alias</span>¹ÒÈëÏàÓ¦<span
lang=EN-US>inode</span>½á¹¹µÄ¶ÓÁĞÖĞ¡£</p>

<p class=MsoPlainText style='margin-left:36.0pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span>ÎªÁË½øÒ»²½ËµÃ÷Ë÷Òı½Úµã¸ßËÙ»º´æ£¬ÎÒÃÇÀ´½øÒ»²½¿¼²ì<span
lang=EN-US>iget</span>£¨£©¡£µ±ÎÒÃÇ´ò¿ªÒ»¸öÎÄ¼şÊ±£¬¾Íµ÷ÓÃÁË<span lang=EN-US>iget</span>£¨£©º¯Êı£¬¶ø<span
lang=EN-US>iget</span>ÕæÕıµ÷ÓÃµÄÊÇ<span lang=EN-US>iget4(sb, ino, NULL, NULL)</span>º¯Êı£¬¸Ãº¯Êı´úÂëÈçÏÂ£º</p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=GramE>struct</span>
inode *iget4(struct super_block *sb, unsigned long ino, find_inode_t
find_actor, void *opaque)</span></p>

<p class=MsoPlainText><span lang=EN-US>{</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
class=GramE>struct</span> list_head * head = inode_hashtable + hash(sb,ino);</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>struct</span> inode * inode;</span></p>

<p class=MsoPlainText><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>spin_<span class=GramE>lock(</span>&amp;inode_lock);</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>inode</span> = find_inode(sb, ino, head, find_actor,
opaque);</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>if</span> (inode) {</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>__<span class=GramE>iget(</span>inode);</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>spin_<span class=GramE>unlock(</span>&amp;inode_lock);</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>wait_on_<span class=GramE>inode(</span>inode);</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> inode;</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>}</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>spin_<span class=GramE>unlock(</span>&amp;inode_lock);</span></p>

<p class=MsoPlainText><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>/*</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>* get_new_<span class=GramE>inode(</span>) will do the right thing,
re-trying the search</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>* <span
class=GramE>in</span> case it had to block at any point.</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>*/</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE>return</span> get_new_inode(sb, ino, head, find_actor,
opaque);</span></p>

<p class=MsoPlainText><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;
</span>}</span></p>

<p class=MsoPlainText><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span>ÏÂÃæ¶ÔÒÔÉÏ´úÂë¸ø³ö½øÒ»²½µÄ½âÊÍ£º</p>

<p class=MsoPlainText style='margin-left:21.25pt;text-indent:-21.25pt;
mso-list:l3 level1 lfo6;tab-stops:list 21.25pt'><![if !supportLists]><span
lang=EN-US style='mso-hansi-font-family:Wingdings;mso-bidi-font-family:ËÎÌå'><span
style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>inode</span>½á¹¹ÖĞÓĞ¸ö¹şÏ£±í<span
lang=EN-US>inode_hashtable</span>£¬Ê×ÏÈÔÚ<span lang=EN-US>inode_lock</span>ËøµÄ±£»¤ÏÂ£¬Í¨¹ı<span
lang=EN-US>find_ inode</span>º¯ÊıÔÚ¹şÏ£±íÖĞ²éÕÒÄ¿±ê½ÚµãµÄ<span lang=EN-US>inode</span>½á¹¹£¬ÓÉÓÚË÷Òı½ÚµãºÅÖ»ÓĞÔÚÍ¬Ò»Éè±¸ÉÏÊ±²ÅÊÇÎ¨Ò»µÄ£¬Òò´Ë£¬ÔÚ¹şÏ£¼ÆËãÊ±Òª°ÑË÷Òı½ÚµãËùÔÚÉè±¸µÄ<span
lang=EN-US>super_block</span>½á¹¹µÄµØÖ·Ò²½áºÏ½øÈ¥¡£Èç¹ûÔÚ¹şÏ£±íÖĞÕÒµ½¸Ã½Úµã£¬ÔòÆäÒıÓÃ¼ÆÊı£¨<span lang=EN-US>i_count</span>£©¼Ó<span
lang=EN-US>1</span>£»Èç¹û<span lang=EN-US>i_count</span>ÔÚÔö¼ÓÖ®Ç°Îª<span lang=EN-US>0</span>£¬ËµÃ÷¸Ã½Úµã²»¡°Ôà¡±£¬Ôò¸Ã½Úµãµ±Ç°¿Ï¶¨´¦ÓÚ<span
lang=EN-US>inode_unused list</span>¶ÓÁĞÖĞ£¬ÓÚÊÇ£¬¾Í°Ñ¸Ã½Úµã´ÓÕâ¸ö¶ÓÁĞÉ¾³ı¶ø²åÈë<span lang=EN-US>inode_in_use</span>¶ÓÁĞ£»×îºó£¬°Ñ<span
lang=EN-US>inodes_stat.nr_unused</span>¼õ<span lang=EN-US>1</span>¡£</p>

<p class=MsoPlainText style='margin-left:21.25pt;text-indent:-21.25pt;
mso-list:l3 level1 lfo6;tab-stops:list 21.25pt'><![if !supportLists]><span
lang=EN-US style='mso-hansi-font-family:Wingdings;mso-bidi-font-family:ËÎÌå'><span
style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span>Èç¹û¸Ã½Úµãµ±Ç°±»¼ÓËø£¬Ôò±ØĞëµÈ´ı£¬Ö±µ½½âËø£¬ÒÔ±ãÈ·±£<span
lang=EN-US>iget4()</span>·µ»ØÒ»¸öÎ´¼ÓËøµÄ½Úµã¡£</p>

<p class=MsoPlainText style='margin-left:21.25pt;text-indent:-21.25pt;
mso-list:l3 level1 lfo6;tab-stops:list 21.25pt'><![if !supportLists]><span
lang=EN-US style='mso-hansi-font-family:Wingdings;mso-bidi-font-family:ËÎÌå'><span
style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>Èç¹ûÔÚ¹şÏ£±íÖĞÃ»ÓĞÕÒµ½¸Ã½Úµã£¬ËµÃ÷Ä¿±ê½ÚµãµÄ<span lang=EN-US>inode</span>½á¹¹»¹²»ÔÚÄÚ´æ£¬Òò´Ë£¬µ÷ÓÃ<span
lang=EN-US>get_new_inode()</span>´Ó´ÅÅÌÉÏ¶ÁÈëÏàÓ¦µÄË÷Òı½Úµã²¢½¨Á¢ÆğÒ»¸ö<span lang=EN-US>inode</span>½á¹¹£¬²¢°Ñ¸Ã½á¹¹²åÈëµ½¹şÏ£±íÖĞ¡£</p>

<p class=MsoPlainText style='margin-left:21.25pt;text-indent:-21.25pt;
mso-list:l3 level1 lfo6;tab-stops:list 21.25pt'><![if !supportLists]><span
lang=EN-US style='mso-hansi-font-family:Wingdings;mso-bidi-font-family:ËÎÌå'><span
style='mso-list:Ignore'>¡¤<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>¶Ô<span lang=EN-US>get_new_inode()</span>¸ø³ö½øÒ»²½µÄËµÃ÷£¬¸Ãº¯Êı´Ó<span
lang=EN-US>Slab</span>»º´æÇøÖĞ·ÖÅäÒ»¸öĞÂµÄ<span lang=EN-US>inode</span>½á¹¹£¬µ«ÊÇÕâ¸ö·ÖÅä²Ù×÷ÓĞ¿ÉÄÜ³öÏÖ×èÈû£¬ÓÚÊÇ£¬¾ÍÓ¦µ±½â³ı±£»¤¹şÏ£±íµÄ<span
lang=EN-US>inode_lock</span>×ÔĞıËø£¬ÒÔ±ãÔÚ¹şÏ£±íÖĞÔÙ´Î½øĞĞËÑË÷¡£Èç¹ûÕâ´ÎÔÚ¹şÏ£±íÖĞÕÒµ½Õâ¸öË÷Òı½Úµã£¬¾ÍÍ¨¹ı<span
lang=EN-US>__iget</span>°Ñ¸Ã½ÚµãµÄÒıÓÃ¼ÆÊı¼Ó<span lang=EN-US>1</span>£¬²¢³·ÏúĞÂ·ÖÅäµÄ½Úµã¡£Èç¹ûÔÚ¹şÏ£±íÖĞ»¹Ã»ÓĞÕÒµ½£¬¾ÍÊ¹ÓÃĞÂ·ÖÅäµÄË÷Òı½Úµã£»Òò´Ë£¬°Ñ¸ÃË÷Òı½ÚµãµÄ<span
class=GramE>Ò»Ğ©ÓòÏÈ³õÊ¼»¯</span>Îª±ØĞëµÄÖµ£¬È»ºóµ÷ÓÃ¾ßÌåÎÄ¼şÏµÍ³µÄ<span lang=EN-US>
sb-&gt;s_op-&gt;read_inode()</span>ÓòÌî³ä¸Ã½ÚµãµÄÆäËûÓò¡£Õâ¾Í°ÑÎÒÃÇ´ÓË÷Òı½Úµã¸ßËÙ»º´æ´øµ½ÁËÄ³¸ö¾ßÌåÎÄ¼şÏµÍ³µÄ´úÂëÖĞ¡£µ±<span
lang=EN-US>s_op-&gt;read_inode()</span>·½·¨ÕıÔÚ´Ó´ÅÅÌ¶ÁË÷Òı½ÚµãÊ±£¬¸Ã½Úµã±»¼ÓËø£¨<span lang=EN-US>i_state
= I_LOCK</span>£©£»µ±<span lang=EN-US>read_inode()</span>·µ»ØÊ±£¬¸Ã½ÚµãµÄËø±»½â³ı£¬²¢ÇÒ»½ĞÑËùÓĞµÈ<span
class=GramE>´ıÕß</span>¡£</p>

<p class=MsoPlainText style='text-indent:21.25pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span><span
style='mso-spacerun:yes'>&nbsp;</span><span style='mso-spacerun:yes'>&nbsp;
</span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

</div>

</body>


<!-- Mirrored from www.kerneltravel.net/kernel-book/ç¬¬å…«ç« %20è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ/8.3.2.htm by HTTrack Website Copier/3.x [XR&CO'2008], Sat, 29 Dec 2012 03:01:14 GMT -->
</html>
